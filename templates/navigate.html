<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>üó∫Ô∏è ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á - ‡∏£‡∏û.‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        * { font-family: 'Sarabun', sans-serif; }
        :root { --pink: #e91e8c; }
        body { margin: 0; background: #f0f0f0; }
        
        .top-bar {
            position: fixed; top: 0; left: 0; right: 0;
            background: white; padding: 10px 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000; display: flex; align-items: center; gap: 10px;
        }
        .back-btn { width: 40px; height: 40px; border-radius: 50%; border: none; background: #fce4f1; color: var(--pink); }
        .dest-info { flex: 1; }
        .dest-name { font-weight: 600; font-size: 16px; }
        .dest-detail { font-size: 12px; color: #666; }
        .building-badge { background: var(--pink); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; }
        .voice-btn { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--pink); background: white; color: var(--pink); }
        .voice-btn.active { background: var(--pink); color: white; }
        
        .map-area { position: fixed; top: 60px; left: 0; right: 0; bottom: 200px; background: #e8e8e8; overflow: hidden; }
        .map-wrapper { width: 100%; height: 100%; overflow: auto; position: relative; }
        .map-image { width: 100%; min-height: 100%; }
        
        .bottom-panel {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000;
        }
        .panel-handle { width: 40px; height: 5px; background: #ddd; border-radius: 3px; margin: 10px auto; }
        
        .summary-row { display: flex; padding: 10px 20px; gap: 15px; border-bottom: 1px solid #eee; }
        .summary-item { text-align: center; flex: 1; }
        .summary-value { font-size: 20px; font-weight: 700; color: var(--pink); }
        .summary-label { font-size: 11px; color: #666; }
        
        .instruction-box {
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--pink), #f06ebc);
            color: white;
        }
        .instruction-step { font-size: 12px; opacity: 0.9; }
        .instruction-text { font-size: 16px; font-weight: 600; margin-top: 3px; }
        .speak-btn {
            background: rgba(255,255,255,0.2); border: none; color: white;
            padding: 5px 15px; border-radius: 20px; margin-top: 10px; font-size: 13px;
        }
        
        .steps-list { max-height: 100px; overflow-y: auto; padding: 10px 20px; }
        .step-item { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; gap: 10px; }
        .step-num {
            width: 24px; height: 24px; border-radius: 50%;
            background: #fce4f1; color: var(--pink);
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 12px;
        }
        .step-item.done .step-num { background: #28a745; color: white; }
        .step-item.current { background: #fce4f1; margin: 0 -20px; padding: 8px 20px; }
        .step-text { flex: 1; font-size: 13px; }
        
        .control-btns {
            position: fixed; left: 10px; bottom: 220px;
            display: flex; flex-direction: column; gap: 8px; z-index: 500;
        }
        .ctrl-btn {
            width: 45px; height: 45px; border-radius: 50%;
            border: none; background: white; font-size: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }
        .ctrl-btn.qr { background: var(--pink); color: white; }
    </style>
</head>
<body>
    <div class="top-bar">
        <button class="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>
        <div class="dest-info">
            <div class="dest-name" id="dest-name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            <div class="dest-detail">
                <span id="building-name"></span>
                <span class="building-badge" id="floor-badge">‡∏ä‡∏±‡πâ‡∏ô 1</span>
            </div>
        </div>
        <button class="voice-btn active" id="voice-btn" onclick="toggleVoice()">
            <i class="fas fa-volume-up"></i>
        </button>
    </div>
    
    <div class="map-area">
        <div class="map-wrapper">
            <img src="/static/images/maps/campus-map.jpg" class="map-image" id="map-image">
        </div>
    </div>
    
    <div class="control-btns">
        <button class="ctrl-btn" onclick="zoomIn()"><i class="fas fa-plus"></i></button>
        <button class="ctrl-btn" onclick="zoomOut()"><i class="fas fa-minus"></i></button>
        <button class="ctrl-btn qr" onclick="nextStep()"><i class="fas fa-arrow-right"></i></button>
    </div>
    
    <div class="bottom-panel">
        <div class="panel-handle"></div>
        <div class="summary-row">
            <div class="summary-item">
                <div class="summary-value" id="distance">--</div>
                <div class="summary-label">‡πÄ‡∏°‡∏ï‡∏£</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="time">--</div>
                <div class="summary-label">‡∏ô‡∏≤‡∏ó‡∏µ</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="current-floor">1</div>
                <div class="summary-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
            </div>
        </div>
        <div class="instruction-box">
            <div class="instruction-step">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà <span id="step-num">1</span> ‡∏à‡∏≤‡∏Å <span id="total-steps">5</span></div>
            <div class="instruction-text" id="instruction-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á...</div>
            <button class="speak-btn" onclick="speakCurrentStep()">
                <i class="fas fa-volume-up me-1"></i>‡∏ü‡∏±‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
            </button>
        </div>
        <div class="steps-list" id="steps-list"></div>
    </div>

    <script>
        const BUILDINGS = {
            'A': '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏®‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ò‡∏¥‡∏£‡∏≤‡∏ä', 'B': '‡∏ï‡∏∂‡∏Å‡∏™‡∏¥‡∏£‡∏¥‡∏ô‡∏ò‡∏£',
            'CHALERM': '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏Ø', 'D': '‡∏ï‡∏∂‡∏Å‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£',
            'E': '‡∏ï‡∏∂‡∏Å‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡∏∞‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô', 'F': '‡∏ï‡∏∂‡∏Å‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°',
            'G': '‡∏ï‡∏∂‡∏Å‡∏™‡∏≠‡∏≤‡∏î ‡∏®‡∏¥‡∏£‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå', 'H': '‡∏ï‡∏∂‡∏Å‡∏´‡∏•‡∏ß‡∏á‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Ø'
        };
        
        let destBuilding = 'CHALERM', destFloor = '11', destRoom = '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÇ‡∏¢‡∏ò‡∏µ';
        let currentStep = 0, voiceEnabled = true, mapScale = 1;
        let steps = [];
        
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            if (params.get('building')) destBuilding = params.get('building');
            if (params.get('floor')) destFloor = params.get('floor');
            if (params.get('dest')) destRoom = params.get('dest');
            if (params.get('voice') === '0') voiceEnabled = false;
            
            document.getElementById('dest-name').textContent = destRoom || '‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á';
            document.getElementById('building-name').textContent = BUILDINGS[destBuilding] || destBuilding;
            document.getElementById('floor-badge').textContent = `‡∏ä‡∏±‡πâ‡∏ô ${destFloor}`;
            updateVoiceButton();
            generateSteps();
            
            setTimeout(() => { if (voiceEnabled) speakCurrentStep(); }, 1000);
        });
        
        function generateSteps() {
            steps = [
                { text: `‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á${BUILDINGS[destBuilding] || destBuilding}`, distance: 50 },
                { text: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£', distance: 10 },
                { text: '‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÇ‡∏ñ‡∏á‡∏•‡∏¥‡∏ü‡∏ï‡πå', distance: 20 },
                { text: `‡∏Ç‡∏∂‡πâ‡∏ô‡∏•‡∏¥‡∏ü‡∏ï‡πå‡πÑ‡∏õ‡∏ä‡∏±‡πâ‡∏ô ${destFloor}`, distance: 0 },
                { text: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏ü‡∏ï‡πå‡∏ï‡∏≤‡∏°‡∏õ‡πâ‡∏≤‡∏¢‡∏ö‡∏≠‡∏Å‡∏ó‡∏≤‡∏á', distance: 15 },
                { text: `‡∏ñ‡∏∂‡∏á${destRoom}‡πÅ‡∏•‡πâ‡∏ß`, distance: 0 }
            ];
            
            renderSteps();
            const totalDist = steps.reduce((sum, s) => sum + s.distance, 0);
            document.getElementById('distance').textContent = totalDist;
            document.getElementById('time').textContent = Math.ceil(totalDist / 50) + 1;
        }
        
        function renderSteps() {
            document.getElementById('total-steps').textContent = steps.length;
            document.getElementById('step-num').textContent = currentStep + 1;
            document.getElementById('instruction-text').textContent = steps[currentStep]?.text || '';
            
            document.getElementById('steps-list').innerHTML = steps.map((step, i) => `
                <div class="step-item ${i < currentStep ? 'done' : ''} ${i === currentStep ? 'current' : ''}">
                    <div class="step-num">${i < currentStep ? '<i class="fas fa-check"></i>' : i + 1}</div>
                    <div class="step-text">${step.text}</div>
                </div>
            `).join('');
        }
        
        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                renderSteps();
                if (voiceEnabled) speakCurrentStep();
            }
        }
        
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            updateVoiceButton();
            if (voiceEnabled) speak('‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞');
        }
        
        function updateVoiceButton() {
            const btn = document.getElementById('voice-btn');
            btn.classList.toggle('active', voiceEnabled);
            btn.innerHTML = `<i class="fas fa-volume-${voiceEnabled ? 'up' : 'mute'}"></i>`;
        }
        
        function speak(text) {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'th-TH';
            utterance.rate = 0.85;
            const voices = window.speechSynthesis.getVoices();
            const thaiVoice = voices.find(v => v.lang.includes('th'));
            if (thaiVoice) utterance.voice = thaiVoice;
            window.speechSynthesis.speak(utterance);
        }
        
        function speakCurrentStep() {
            if (!voiceEnabled) return;
            const step = steps[currentStep];
            if (step) speak(`‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${currentStep + 1}: ${step.text}`);
        }
        
        function zoomIn() { mapScale = Math.min(mapScale * 1.3, 3); applyZoom(); }
        function zoomOut() { mapScale = Math.max(mapScale / 1.3, 0.5); applyZoom(); }
        function applyZoom() {
            document.getElementById('map-image').style.transform = `scale(${mapScale})`;
            document.getElementById('map-image').style.transformOrigin = 'center center';
        }
        
        function goBack() {
            window.speechSynthesis?.cancel();
            window.location.href = '/';
        }
    </script>
</body>
</html>
