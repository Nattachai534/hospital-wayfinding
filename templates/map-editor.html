<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üó∫Ô∏è Map Editor - ‡∏£‡∏û.‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        * { font-family: 'Sarabun', sans-serif; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { --pink: #e91e8c; --pink-light: #fce4f1; }
        body { background: #f0f0f0; margin: 0; padding: 10px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 10px; background: white; padding: 12px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header h5 { margin: 0; color: var(--pink); font-size: 16px; }
        .main-layout { display: flex; gap: 10px; }
        .map-section { flex: 1; min-width: 0; }
        .control-section { width: 350px; flex-shrink: 0; }
        @media (max-width: 1000px) { .main-layout { flex-direction: column; } .control-section { width: 100%; } }
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 10px; overflow: hidden; }
        .card-header { background: linear-gradient(135deg, var(--pink), #f06ebc); color: white; padding: 10px 12px; font-weight: 600; font-size: 14px; }
        .card-body { padding: 12px; }
        .floor-tabs { display: flex; flex-wrap: wrap; gap: 4px; max-height: 80px; overflow-y: auto; }
        .floor-tab { padding: 5px 10px; border: 2px solid #ddd; border-radius: 6px; background: white; cursor: pointer; font-weight: 600; font-size: 12px; }
        .floor-tab:hover { border-color: var(--pink); }
        .floor-tab.active { background: var(--pink); color: white; border-color: var(--pink); }
        .floor-tab.has-data { background: #d4edda; border-color: #28a745; }
        .floor-tab.has-data.active { background: var(--pink); }
        .map-container { position: relative; border: 3px solid #ddd; border-radius: 10px; overflow: hidden; background: #f5f5f5; min-height: 350px; touch-action: none; }
        .map-image { width: 100%; display: block; cursor: crosshair; -webkit-user-drag: none; user-select: none; pointer-events: auto; }
        .markers-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .upload-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .upload-overlay.show { display: flex; }
        .upload-overlay i { font-size: 40px; color: #ccc; margin-bottom: 10px; }
        .marker { position: absolute; width: 40px; height: 40px; background: var(--pink); border: 3px solid white; border-radius: 50%; transform: translate(-50%, -50%); cursor: grab; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; pointer-events: auto; box-shadow: 0 3px 10px rgba(0,0,0,0.3); z-index: 100; touch-action: none; }
        .marker:active { cursor: grabbing; }
        .marker.selected { border-color: #ffc107; box-shadow: 0 0 0 4px rgba(255,193,7,0.5), 0 3px 10px rgba(0,0,0,0.3); z-index: 200; }
        .marker.dragging { opacity: 0.7; transform: translate(-50%, -50%) scale(1.2); }
        .marker.entrance { background: #28a745; }
        .marker.lift { background: #fd7e14; }
        .marker.stairs { background: #20c997; }
        .marker.conference { background: #6f42c1; }
        .marker.er { background: #dc3545; }
        .marker.opd { background: #17a2b8; }
        .marker.service { background: #6c757d; }
        .marker.restroom { background: #795548; }
        .marker.pharmacy { background: #4caf50; }
        .marker.cashier { background: #ff9800; }
        .marker.lab { background: #9c27b0; }
        .marker.xray { background: #00bcd4; }
        .marker.parking { background: #607d8b; }
        .marker.food { background: #ff5722; }
        .marker-label { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; white-space: nowrap; margin-top: 5px; pointer-events: none; }
        .stats-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .stat-box { flex: 1; text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px; }
        .stat-value { font-size: 20px; font-weight: 700; color: var(--pink); }
        .stat-label { font-size: 10px; color: #666; }
        .location-list { max-height: 200px; overflow-y: auto; }
        .location-item { display: flex; align-items: center; padding: 8px; border: 2px solid #eee; border-radius: 8px; margin-bottom: 6px; cursor: pointer; }
        .location-item:hover { background: #f8f9fa; border-color: var(--pink); }
        .location-item.selected { background: var(--pink-light); border-color: var(--pink); }
        .loc-icon { width: 32px; height: 32px; border-radius: 50%; background: var(--pink); color: white; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 12px; flex-shrink: 0; }
        .loc-info { flex: 1; min-width: 0; }
        .loc-name { font-weight: 600; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .loc-detail { font-size: 10px; color: #666; }
        .loc-actions { display: flex; gap: 4px; }
        .loc-actions .btn { padding: 3px 6px; font-size: 11px; }
        .type-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; }
        .type-btn { padding: 6px 4px; border: 2px solid #eee; border-radius: 6px; background: white; cursor: pointer; text-align: center; font-size: 10px; }
        .type-btn:hover { border-color: var(--pink); }
        .type-btn.selected { background: var(--pink); color: white; border-color: var(--pink); }
        .type-btn i { display: block; font-size: 14px; margin-bottom: 2px; }
        .btn-pink { background: var(--pink); border-color: var(--pink); color: white; }
        .btn-pink:hover { background: #d81b7a; color: white; }
        .coords-bar { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 8px 20px; border-radius: 20px; font-size: 12px; z-index: 1000; }
        .empty-state { text-align: center; padding: 20px; color: #999; }
        .empty-state i { font-size: 36px; margin-bottom: 10px; opacity: 0.3; }
        .gps-btn { position: fixed; bottom: 70px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--pink); color: white; border: none; font-size: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1000; }
        .form-control-sm { font-size: 13px; }
    </style>
</head>
<body>
    <!-- Login Check -->
    <div id="login-overlay" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:9999;display:flex;align-items:center;justify-content:center;">
        <div style="background:white;padding:30px;border-radius:15px;text-align:center;max-width:350px;width:90%;">
            <i class="fas fa-lock" style="font-size:40px;color:#e91e8c;margin-bottom:15px;"></i>
            <h5>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Map Editor</h5>
            <input type="password" id="login-password" class="form-control my-3" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button class="btn btn-pink w-100" onclick="checkLogin()"><i class="fas fa-sign-in-alt me-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <div id="login-error" class="text-danger mt-2" style="display:none;">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
            <a href="/" class="d-block mt-3 text-muted"><i class="fas fa-arrow-left me-1"></i>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        </div>
    </div>

    <div id="main-content" style="display:none;">
        <div class="header">
            <h5><i class="fas fa-map-marked-alt me-2"></i>Map Editor</h5>
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-success btn-sm" onclick="exportData()"><i class="fas fa-download me-1"></i>Export</button>
                <button class="btn btn-outline-primary btn-sm" onclick="importData()"><i class="fas fa-upload me-1"></i>Import</button>
                <a href="/" class="btn btn-outline-secondary btn-sm"><i class="fas fa-home me-1"></i>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <button class="btn btn-outline-danger btn-sm" onclick="logout()"><i class="fas fa-sign-out-alt me-1"></i>‡∏≠‡∏≠‡∏Å</button>
            </div>
        </div>
        
        <div class="main-layout">
            <div class="map-section">
                <div class="card">
                    <div class="card-header"><i class="fas fa-building me-2"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡πâ‡∏ô</div>
                    <div class="card-body">
                        <div class="d-flex gap-2 mb-2">
                            <select class="form-select form-select-sm" id="building-select" onchange="onBuildingChange()"></select>
                            <button class="btn btn-outline-secondary btn-sm" onclick="uploadFloorPlan()"><i class="fas fa-image"></i></button>
                            <input type="file" id="floor-plan-input" accept="image/*" hidden onchange="handleFloorPlanUpload(event)">
                        </div>
                        <div class="floor-tabs" id="floor-tabs"></div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body p-0">
                        <div class="map-container" id="map-container">
                            <img src="" class="map-image" id="map-image">
                            <div class="markers-layer" id="markers-layer"></div>
                            <div class="upload-overlay show" id="upload-overlay" onclick="uploadFloorPlan()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <div class="text-muted">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Floor Plan</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted"><i class="fas fa-hand-pointer me-1"></i>‡πÅ‡∏ï‡∏∞/‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° | ‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢</small>
                    <button class="btn btn-outline-danger btn-sm" onclick="clearFloorMarkers()"><i class="fas fa-trash me-1"></i>‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏±‡πâ‡∏ô</button>
                </div>
            </div>
            
            <div class="control-section">
                <div class="stats-row">
                    <div class="stat-box"><div class="stat-value" id="stat-total">0</div><div class="stat-label">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div></div>
                    <div class="stat-box"><div class="stat-value" id="stat-building">0</div><div class="stat-label">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ô‡∏µ‡πâ</div></div>
                    <div class="stat-box"><div class="stat-value" id="stat-floor">0</div><div class="stat-label">‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</div></div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between"><span><i class="fas fa-list me-2"></i>‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</span><span class="badge bg-light text-dark" id="loc-count">0</span></div>
                    <div class="card-body p-2"><div class="location-list" id="location-list"></div></div>
                </div>
                
                <div class="card">
                    <div class="card-header"><i class="fas fa-plus-circle me-2"></i><span id="form-title">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà</span></div>
                    <div class="card-body">
                        <form id="location-form" onsubmit="onFormSubmit(event)">
                            <div class="row mb-2">
                                <div class="col-8"><input type="text" class="form-control form-control-sm" id="inp-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏∏‡∏î *" required></div>
                                <div class="col-4"><input type="text" class="form-control form-control-sm" id="inp-code" placeholder="‡∏£‡∏´‡∏±‡∏™ *" required></div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6"><input type="number" class="form-control form-control-sm" id="inp-x" placeholder="X %" step="0.1" required></div>
                                <div class="col-6"><input type="number" class="form-control form-control-sm" id="inp-y" placeholder="Y %" step="0.1" required></div>
                            </div>
                            <div class="mb-2"><label class="form-label small fw-bold mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><div class="type-grid" id="type-grid"></div></div>
                            <div class="mb-2"><input type="text" class="form-control form-control-sm" id="inp-note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏/‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ó‡∏≤‡∏á"></div>
                            <div class="mb-2"><input type="text" class="form-control form-control-sm" id="inp-voice" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á (TTS)"></div>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-pink btn-sm flex-fill" id="btn-submit"><i class="fas fa-plus me-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="resetForm()" id="btn-cancel" style="display:none;"><i class="fas fa-times"></i></button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header"><i class="fas fa-qrcode me-2"></i>QR Code</div>
                    <div class="card-body">
                        <button class="btn btn-outline-primary btn-sm w-100 mb-2" id="btn-generate-qr" onclick="generateQR()" disabled><i class="fas fa-qrcode me-1"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á QR</button>
                        <button class="btn btn-outline-success btn-sm w-100" onclick="generateAllQR()"><i class="fas fa-print me-1"></i>‡∏û‡∏¥‡∏°‡∏û‡πå QR ‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏±‡πâ‡∏ô</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="coords-bar"><i class="fas fa-crosshairs me-2"></i><span id="coords-text">X: --, Y: --</span> | <span id="coords-floor">--</span></div>
        <button class="gps-btn" onclick="getGPS()" title="‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS"><i class="fas fa-location-crosshairs"></i></button>
    </div>

    <!-- QR Modal -->
    <div class="modal fade" id="qrModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h6 class="modal-title"><i class="fas fa-qrcode me-2"></i>QR Code</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body text-center"><div id="qr-code" class="mb-3"></div><div id="qr-info" class="small text-start bg-light p-2 rounded"></div></div>
                <div class="modal-footer">
                    <button class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                    <button class="btn btn-primary btn-sm" onclick="downloadQR()"><i class="fas fa-download me-1"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
                    <button class="btn btn-success btn-sm" onclick="printQR()"><i class="fas fa-print me-1"></i>‡∏û‡∏¥‡∏°‡∏û‡πå</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal fade" id="importModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h6 class="modal-title">Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body"><textarea class="form-control" id="import-json" rows="8" placeholder="‡∏ß‡∏≤‡∏á JSON..."></textarea></div>
                <div class="modal-footer"><button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button class="btn btn-primary btn-sm" onclick="doImport()">Import</button></div>
            </div>
        </div>
    </div>

    <!-- GPS Modal -->
    <div class="modal fade" id="gpsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h6 class="modal-title"><i class="fas fa-location-dot me-2"></i>‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div id="gps-status" class="text-center mb-3"><i class="fas fa-spinner fa-spin fa-2x text-muted"></i><p class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î...</p></div>
                    <div id="gps-result" style="display:none;">
                        <div class="row mb-2"><div class="col-4 fw-bold">Latitude:</div><div class="col-8" id="gps-lat">-</div></div>
                        <div class="row mb-2"><div class="col-4 fw-bold">Longitude:</div><div class="col-8" id="gps-lng">-</div></div>
                        <div class="row mb-2"><div class="col-4 fw-bold">Accuracy:</div><div class="col-8" id="gps-acc">-</div></div>
                        <button class="btn btn-pink btn-sm w-100 mt-2" onclick="useGPS()"><i class="fas fa-check me-1"></i>‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ô‡∏µ‡πâ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ==================== CONFIG ====================
        const BUILDINGS = [
            { code: 'A', name: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏®‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ò‡∏¥‡∏£‡∏≤‡∏ä (‡∏ï‡∏∂‡∏Å A)', floors: ['B1','G','M','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25'] },
            { code: 'B', name: '‡∏ï‡∏∂‡∏Å‡∏™‡∏¥‡∏£‡∏¥‡∏ô‡∏ò‡∏£ (‡∏ï‡∏∂‡∏Å B)', floors: ['G','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18'] },
            { code: 'CHALERM', name: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏Ø', floors: ['G','1','M','2','3','4','5','6','7','8','9','10','11','12'] },
            { code: 'D', name: '‡∏ï‡∏∂‡∏Å‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ï‡∏∂‡∏Å D)', floors: ['G','1','2','3','4','5'] },
            { code: 'E', name: '‡∏ï‡∏∂‡∏Å‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡∏∞‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô EMS (‡∏ï‡∏∂‡∏Å E)', floors: ['G','1','2','3','4'] },
            { code: 'F', name: '‡∏ï‡∏∂‡∏Å‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° (‡∏ï‡∏∂‡∏Å F)', floors: ['G','1','2','3','4','5','6'] },
            { code: 'G', name: '‡∏ï‡∏∂‡∏Å‡∏™‡∏≠‡∏≤‡∏î ‡∏®‡∏¥‡∏£‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå (‡∏ï‡∏∂‡∏Å G)', floors: ['G','1','2','3','4','5','6','7','8'] },
            { code: 'H', name: '‡∏ï‡∏∂‡∏Å‡∏´‡∏•‡∏ß‡∏á‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡πÄ‡∏ô‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡∏ï‡∏∂‡∏Å H)', floors: ['G','1','2','3','4','5','6'] },
            { code: 'I', name: '‡∏ï‡∏∂‡∏Å‡πÄ‡∏à‡∏£‡∏¥‡∏ç ‡∏û‡∏π‡∏•‡∏ß‡∏£‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå (‡∏ï‡∏∂‡∏Å I)', floors: ['G','1','2','3','4','5'] },
            { code: 'J', name: '‡∏ï‡∏∂‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à (‡∏ï‡∏∂‡∏Å J)', floors: ['G','1','2','3','4'] },
            { code: 'K', name: '‡∏ï‡∏∂‡∏Å‡∏ß‡∏≤‡∏®‡∏≠‡∏∏‡∏ó‡∏¥‡∏® (‡∏ï‡∏∂‡∏Å K)', floors: ['G','1','2','3'] }
        ];
        
        const LOCATION_TYPES = [
            { code: 'entrance', name: '‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤', icon: 'door-open', color: '#28a745' },
            { code: 'lift', name: '‡∏•‡∏¥‡∏ü‡∏ï‡πå', icon: 'elevator', color: '#fd7e14' },
            { code: 'stairs', name: '‡∏ö‡∏±‡∏ô‡πÑ‡∏î', icon: 'stairs', color: '#20c997' },
            { code: 'conference', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°', icon: 'users', color: '#6f42c1' },
            { code: 'er', name: '‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô', icon: 'ambulance', color: '#dc3545' },
            { code: 'opd', name: 'OPD', icon: 'hospital', color: '#17a2b8' },
            { code: 'service', name: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', icon: 'concierge-bell', color: '#6c757d' },
            { code: 'restroom', name: '‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥', icon: 'restroom', color: '#795548' },
            { code: 'pharmacy', name: '‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤', icon: 'pills', color: '#4caf50' },
            { code: 'cashier', name: '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', icon: 'cash-register', color: '#ff9800' },
            { code: 'lab', name: 'Lab', icon: 'flask', color: '#9c27b0' },
            { code: 'xray', name: 'X-Ray', icon: 'x-ray', color: '#00bcd4' },
            { code: 'parking', name: '‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ', icon: 'car', color: '#607d8b' },
            { code: 'food', name: '‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£', icon: 'utensils', color: '#ff5722' },
            { code: 'room', name: '‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ', icon: 'door-closed', color: '#e91e8c' }
        ];
        
        let currentBuilding = 'CHALERM', currentFloor = '11', locations = [], floorImages = {};
        let selectedId = null, editingId = null, selectedType = 'room';
        let isDragging = false, dragMarkerId = null, dragStartPos = null;
        let currentGPS = null;

        // ==================== LOGIN ====================
        function checkLogin() {
            const pw = document.getElementById('login-password').value;
            fetch('/api/verify-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: pw })
            }).then(r => r.json()).then(data => {
                if (data.success) {
                    sessionStorage.setItem('adminLoggedIn', 'true');
                    document.getElementById('login-overlay').style.display = 'none';
                    document.getElementById('main-content').style.display = 'block';
                } else {
                    document.getElementById('login-error').style.display = 'block';
                }
            }).catch(() => {
                // Fallback for local testing
                if (pw === 'rajavithi2024') {
                    sessionStorage.setItem('adminLoggedIn', 'true');
                    document.getElementById('login-overlay').style.display = 'none';
                    document.getElementById('main-content').style.display = 'block';
                } else {
                    document.getElementById('login-error').style.display = 'block';
                }
            });
        }
        
        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            location.reload();
        }

        document.getElementById('login-password').addEventListener('keypress', e => { if (e.key === 'Enter') checkLogin(); });

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
            }
            loadFromStorage();
            initUI();
            render();
            setupTouchEvents();
        });

        function initUI() {
            document.getElementById('building-select').innerHTML = BUILDINGS.map(b => `<option value="${b.code}">${b.name}</option>`).join('');
            document.getElementById('building-select').value = currentBuilding;
            renderTypeGrid();
            renderFloorTabs();
            updateMapImage();
        }

        function renderTypeGrid() {
            document.getElementById('type-grid').innerHTML = LOCATION_TYPES.map(t => 
                `<div class="type-btn ${selectedType === t.code ? 'selected' : ''}" onclick="selectType('${t.code}')">
                    <i class="fas fa-${t.icon}" style="color:${selectedType === t.code ? 'white' : t.color}"></i>${t.name}
                </div>`
            ).join('');
        }

        function selectType(type) { selectedType = type; renderTypeGrid(); }

        // ==================== BUILDING & FLOOR ====================
        function onBuildingChange() {
            currentBuilding = document.getElementById('building-select').value;
            const bld = BUILDINGS.find(b => b.code === currentBuilding);
            currentFloor = bld?.floors[0] || '1';
            renderFloorTabs();
            updateMapImage();
            render();
        }

        function renderFloorTabs() {
            const bld = BUILDINGS.find(b => b.code === currentBuilding);
            const floors = bld?.floors || ['1'];
            document.getElementById('floor-tabs').innerHTML = floors.map(f => {
                const hasData = locations.some(l => l.building === currentBuilding && l.floor === f);
                return `<div class="floor-tab ${f === currentFloor ? 'active' : ''} ${hasData && f !== currentFloor ? 'has-data' : ''}" onclick="selectFloor('${f}')">${f}</div>`;
            }).join('');
        }

        function selectFloor(floor) {
            currentFloor = floor;
            selectedId = editingId = null;
            resetForm();
            renderFloorTabs();
            updateMapImage();
            render();
        }

        function updateMapImage() {
            const key = `${currentBuilding}_${currentFloor}`;
            const img = document.getElementById('map-image');
            const overlay = document.getElementById('upload-overlay');
            if (floorImages[key]) {
                img.src = floorImages[key];
                overlay.classList.remove('show');
            } else {
                img.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="500"><rect fill="%23f5f5f5" width="800" height="500"/><text x="400" y="250" text-anchor="middle" fill="%23ccc" font-size="20">Floor Plan</text></svg>';
                overlay.classList.add('show');
            }
        }

        // ==================== FLOOR PLAN UPLOAD ====================
        function uploadFloorPlan() { document.getElementById('floor-plan-input').click(); }
        function handleFloorPlanUpload(e) { if (e.target.files[0]) processFile(e.target.files[0]); }
        function processFile(file) {
            const reader = new FileReader();
            reader.onload = e => {
                floorImages[`${currentBuilding}_${currentFloor}`] = e.target.result;
                updateMapImage();
                saveToStorage();
            };
            reader.readAsDataURL(file);
        }

        // ==================== TOUCH & MOUSE EVENTS ====================
        function setupTouchEvents() {
            const container = document.getElementById('map-container');
            const img = document.getElementById('map-image');

            // Mouse events for map
            img.addEventListener('click', onMapClick);
            img.addEventListener('mousemove', onMapMove);

            // Touch events for map
            img.addEventListener('touchend', onMapTouch);

            // Drag & Drop floor plan
            container.addEventListener('dragover', e => { e.preventDefault(); container.classList.add('drag-over'); });
            container.addEventListener('dragleave', () => container.classList.remove('drag-over'));
            container.addEventListener('drop', e => {
                e.preventDefault();
                container.classList.remove('drag-over');
                if (e.dataTransfer.files[0]?.type.startsWith('image/')) processFile(e.dataTransfer.files[0]);
            });
        }

        function getCoords(e, img) {
            const rect = img.getBoundingClientRect();
            let clientX, clientY;
            if (e.touches) {
                clientX = e.touches[0]?.clientX || e.changedTouches[0]?.clientX;
                clientY = e.touches[0]?.clientY || e.changedTouches[0]?.clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            return {
                x: Math.max(0, Math.min(100, (clientX - rect.left) / rect.width * 100)),
                y: Math.max(0, Math.min(100, (clientY - rect.top) / rect.height * 100))
            };
        }

        function onMapClick(e) {
            if (isDragging) return;
            const coords = getCoords(e, e.target);
            document.getElementById('inp-x').value = coords.x.toFixed(1);
            document.getElementById('inp-y').value = coords.y.toFixed(1);
            document.getElementById('inp-name').focus();
        }

        function onMapTouch(e) {
            if (isDragging) return;
            const coords = getCoords(e, e.target);
            document.getElementById('inp-x').value = coords.x.toFixed(1);
            document.getElementById('inp-y').value = coords.y.toFixed(1);
        }

        function onMapMove(e) {
            const coords = getCoords(e, e.target);
            document.getElementById('coords-text').textContent = `X: ${coords.x.toFixed(1)}%, Y: ${coords.y.toFixed(1)}%`;
            const bld = BUILDINGS.find(b => b.code === currentBuilding);
            document.getElementById('coords-floor').textContent = `${bld?.name.split('(')[0].trim()} ‡∏ä‡∏±‡πâ‡∏ô ${currentFloor}`;
        }

        // ==================== MARKER DRAG (Touch + Mouse) ====================
        function setupMarkerDrag(marker, id) {
            const img = document.getElementById('map-image');

            // Mouse drag
            marker.addEventListener('mousedown', e => {
                e.preventDefault();
                e.stopPropagation();
                startDrag(id, marker);
            });

            // Touch drag
            marker.addEventListener('touchstart', e => {
                e.preventDefault();
                startDrag(id, marker);
            }, { passive: false });
        }

        function startDrag(id, marker) {
            isDragging = true;
            dragMarkerId = id;
            marker.classList.add('dragging');
            selectLocation(id);

            document.addEventListener('mousemove', onDragMove);
            document.addEventListener('mouseup', onDragEnd);
            document.addEventListener('touchmove', onDragMove, { passive: false });
            document.addEventListener('touchend', onDragEnd);
        }

        function onDragMove(e) {
            if (!isDragging || !dragMarkerId) return;
            e.preventDefault();

            const img = document.getElementById('map-image');
            const rect = img.getBoundingClientRect();
            let clientX, clientY;

            if (e.touches) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            let x = Math.max(0, Math.min(100, (clientX - rect.left) / rect.width * 100));
            let y = Math.max(0, Math.min(100, (clientY - rect.top) / rect.height * 100));

            const loc = locations.find(l => l.id === dragMarkerId);
            if (loc) {
                loc.x = x;
                loc.y = y;
                document.getElementById('inp-x').value = x.toFixed(1);
                document.getElementById('inp-y').value = y.toFixed(1);

                const marker = document.querySelector(`.marker[data-id="${dragMarkerId}"]`);
                if (marker) {
                    marker.style.left = x + '%';
                    marker.style.top = y + '%';
                }
            }
        }

        function onDragEnd() {
            if (isDragging) {
                const marker = document.querySelector(`.marker[data-id="${dragMarkerId}"]`);
                if (marker) marker.classList.remove('dragging');
                isDragging = false;
                dragMarkerId = null;
                saveToStorage();
                renderLocationList();
            }
            document.removeEventListener('mousemove', onDragMove);
            document.removeEventListener('mouseup', onDragEnd);
            document.removeEventListener('touchmove', onDragMove);
            document.removeEventListener('touchend', onDragEnd);
        }

        // ==================== RENDER ====================
        function render() { renderMarkers(); renderLocationList(); updateStats(); }

        function renderMarkers() {
            const layer = document.getElementById('markers-layer');
            const floorLocs = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor);
            layer.innerHTML = floorLocs.map(loc => {
                const type = LOCATION_TYPES.find(t => t.code === loc.type) || LOCATION_TYPES[14];
                return `<div class="marker ${loc.type} ${selectedId === loc.id ? 'selected' : ''}" 
                    style="left:${loc.x}%;top:${loc.y}%;background:${type.color}" data-id="${loc.id}">
                    <i class="fas fa-${type.icon}"></i>
                    <div class="marker-label">${loc.name}</div>
                </div>`;
            }).join('');

            // Setup drag for each marker
            layer.querySelectorAll('.marker').forEach(marker => {
                const id = parseInt(marker.dataset.id);
                setupMarkerDrag(marker, id);
                marker.addEventListener('click', e => { e.stopPropagation(); selectLocation(id); });
            });
        }

        function renderLocationList() {
            const list = document.getElementById('location-list');
            const floorLocs = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor);
            document.getElementById('loc-count').textContent = floorLocs.length;

            if (!floorLocs.length) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-map-marker-alt"></i><div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î</div></div>';
                return;
            }

            list.innerHTML = floorLocs.map(loc => {
                const type = LOCATION_TYPES.find(t => t.code === loc.type) || LOCATION_TYPES[14];
                return `<div class="location-item ${selectedId === loc.id ? 'selected' : ''}" onclick="selectLocation(${loc.id})">
                    <div class="loc-icon" style="background:${type.color}"><i class="fas fa-${type.icon}"></i></div>
                    <div class="loc-info">
                        <div class="loc-name">${loc.name}</div>
                        <div class="loc-detail">${loc.code} | X:${loc.x.toFixed(1)} Y:${loc.y.toFixed(1)}</div>
                    </div>
                    <div class="loc-actions">
                        <button class="btn btn-outline-primary btn-sm" onclick="event.stopPropagation();showQR(${loc.id})"><i class="fas fa-qrcode"></i></button>
                        <button class="btn btn-outline-danger btn-sm" onclick="event.stopPropagation();deleteLocation(${loc.id})"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`;
            }).join('');
        }

        function updateStats() {
            document.getElementById('stat-total').textContent = locations.length;
            document.getElementById('stat-building').textContent = locations.filter(l => l.building === currentBuilding).length;
            document.getElementById('stat-floor').textContent = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor).length;
        }

        // ==================== CRUD ====================
        function onFormSubmit(e) {
            e.preventDefault();
            const data = {
                name: document.getElementById('inp-name').value.trim(),
                code: document.getElementById('inp-code').value.trim().toUpperCase(),
                x: parseFloat(document.getElementById('inp-x').value),
                y: parseFloat(document.getElementById('inp-y').value),
                type: selectedType,
                building: currentBuilding,
                floor: currentFloor,
                note: document.getElementById('inp-note').value.trim(),
                voice: document.getElementById('inp-voice').value.trim(),
                gps: currentGPS
            };

            if (editingId) {
                const loc = locations.find(l => l.id === editingId);
                if (loc) Object.assign(loc, data);
            } else {
                data.id = locations.length ? Math.max(...locations.map(l => l.id)) + 1 : 1;
                locations.push(data);
            }

            currentGPS = null;
            resetForm();
            render();
            saveToStorage();
        }

        function selectLocation(id) {
            selectedId = id;
            const loc = locations.find(l => l.id === id);
            if (loc) {
                document.getElementById('inp-name').value = loc.name;
                document.getElementById('inp-code').value = loc.code;
                document.getElementById('inp-x').value = loc.x.toFixed(1);
                document.getElementById('inp-y').value = loc.y.toFixed(1);
                document.getElementById('inp-note').value = loc.note || '';
                document.getElementById('inp-voice').value = loc.voice || '';
                selectedType = loc.type;
                currentGPS = loc.gps || null;
                renderTypeGrid();
                editingId = id;
                document.getElementById('form-title').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î';
                document.getElementById('btn-submit').innerHTML = '<i class="fas fa-save me-1"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
                document.getElementById('btn-cancel').style.display = 'block';
                document.getElementById('btn-generate-qr').disabled = false;
            }
            render();
        }

        function deleteLocation(id) {
            const loc = locations.find(l => l.id === id);
            if (loc && confirm(`‡∏•‡∏ö "${loc.name}"?`)) {
                locations = locations.filter(l => l.id !== id);
                if (selectedId === id || editingId === id) resetForm();
                render();
                saveToStorage();
            }
        }

        function resetForm() {
            document.getElementById('location-form').reset();
            document.getElementById('form-title').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('btn-submit').innerHTML = '<i class="fas fa-plus me-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°';
            document.getElementById('btn-cancel').style.display = 'none';
            document.getElementById('btn-generate-qr').disabled = true;
            selectedId = editingId = null;
            currentGPS = null;
            selectedType = 'room';
            renderTypeGrid();
            render();
        }

        function clearFloorMarkers() {
            const count = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor).length;
            if (!count) return alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ');
            if (confirm(`‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${count} ‡∏à‡∏∏‡∏î?`)) {
                locations = locations.filter(l => !(l.building === currentBuilding && l.floor === currentFloor));
                resetForm();
                render();
                saveToStorage();
            }
        }

        // ==================== GPS ====================
        function getGPS() {
            const modal = new bootstrap.Modal(document.getElementById('gpsModal'));
            modal.show();
            document.getElementById('gps-status').style.display = 'block';
            document.getElementById('gps-result').style.display = 'none';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    pos => {
                        document.getElementById('gps-status').style.display = 'none';
                        document.getElementById('gps-result').style.display = 'block';
                        document.getElementById('gps-lat').textContent = pos.coords.latitude.toFixed(6);
                        document.getElementById('gps-lng').textContent = pos.coords.longitude.toFixed(6);
                        document.getElementById('gps-acc').textContent = pos.coords.accuracy.toFixed(1) + ' ‡πÄ‡∏°‡∏ï‡∏£';
                        currentGPS = { lat: pos.coords.latitude, lng: pos.coords.longitude, accuracy: pos.coords.accuracy };
                    },
                    err => {
                        document.getElementById('gps-status').innerHTML = `<i class="fas fa-exclamation-circle fa-2x text-danger"></i><p class="mt-2">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÑ‡∏î‡πâ: ${err.message}</p>`;
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            } else {
                document.getElementById('gps-status').innerHTML = '<i class="fas fa-exclamation-circle fa-2x text-danger"></i><p class="mt-2">Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS</p>';
            }
        }

        function useGPS() {
            bootstrap.Modal.getInstance(document.getElementById('gpsModal')).hide();
            if (currentGPS) alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡πÅ‡∏•‡πâ‡∏ß\nLat: ${currentGPS.lat}\nLng: ${currentGPS.lng}`);
        }

        // ==================== QR CODE ====================
        function generateQR() { if (selectedId) showQR(selectedId); }

        function showQR(id) {
            const loc = locations.find(l => l.id === id);
            if (!loc) return;
            const bld = BUILDINGS.find(b => b.code === loc.building);
            const url = `${window.location.origin}/navigate?building=${loc.building}&floor=${loc.floor}&room=${loc.code}&dest=${encodeURIComponent(loc.name)}`;
            
            document.getElementById('qr-code').innerHTML = '';
            new QRCode(document.getElementById('qr-code'), { text: url, width: 180, height: 180, correctLevel: QRCode.CorrectLevel.H });
            document.getElementById('qr-info').innerHTML = `<strong>${loc.name}</strong><br>${bld?.name} ‡∏ä‡∏±‡πâ‡∏ô ${loc.floor}<br><small class="text-muted">${url}</small>`;
            window.currentQRLoc = loc;
            new bootstrap.Modal(document.getElementById('qrModal')).show();
        }

        function downloadQR() {
            const canvas = document.querySelector('#qr-code canvas');
            if (canvas && window.currentQRLoc) {
                const link = document.createElement('a');
                link.download = `QR_${window.currentQRLoc.code}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
        }

        function printQR() {
            const loc = window.currentQRLoc;
            const canvas = document.querySelector('#qr-code canvas');
            if (canvas && loc) {
                const bld = BUILDINGS.find(b => b.code === loc.building);
                const w = window.open('', '_blank');
                w.document.write(`<!DOCTYPE html><html><head><title>QR</title><style>body{font-family:sans-serif;text-align:center;padding:40px}</style></head><body><h2>üè• ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</h2><img src="${canvas.toDataURL()}" width="200"><h3>${loc.name}</h3><p>${bld?.name} ‡∏ä‡∏±‡πâ‡∏ô ${loc.floor}</p></body></html>`);
                w.document.close();
                w.print();
            }
        }

        function generateAllQR() {
            const floorLocs = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor);
            if (!floorLocs.length) return alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ');
            const bld = BUILDINGS.find(b => b.code === currentBuilding);
            const w = window.open('', '_blank');
            w.document.write(`<!DOCTYPE html><html><head><title>QR Codes</title><script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"><\/script><style>body{font-family:sans-serif}.qr{display:inline-block;width:220px;margin:10px;padding:15px;border:1px solid #ddd;border-radius:10px;text-align:center}h1{text-align:center}</style></head><body><h1>üè• ${bld?.name} ‡∏ä‡∏±‡πâ‡∏ô ${currentFloor}</h1><div id="c"></div><script>const locs=${JSON.stringify(floorLocs)};const base="${window.location.origin}";locs.forEach(l=>{const d=document.createElement('div');d.className='qr';const q=document.createElement('div');d.appendChild(q);d.innerHTML+='<h4>'+l.name+'</h4><p>'+l.code+'</p>';document.getElementById('c').appendChild(d);new QRCode(q,{text:base+'/navigate?building='+l.building+'&floor='+l.floor+'&room='+l.code+'&dest='+encodeURIComponent(l.name),width:150,height:150})});setTimeout(()=>window.print(),1000)<\/script></body></html>`);
            w.document.close();
        }

        // ==================== STORAGE ====================
        function saveToStorage() { localStorage.setItem('hospitalMapEditor', JSON.stringify({ locations, floorImages, currentBuilding, currentFloor })); }

        function loadFromStorage() {
            try {
                const saved = localStorage.getItem('hospitalMapEditor');
                if (saved) {
                    const data = JSON.parse(saved);
                    locations = data.locations || [];
                    floorImages = data.floorImages || {};
                    if (data.currentBuilding) currentBuilding = data.currentBuilding;
                    if (data.currentFloor) currentFloor = data.currentFloor;
                }
            } catch (e) { console.error(e); }
            
            if (!locations.length) loadDefaultData();
        }

        function loadDefaultData() {
            locations = [
                // ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏Ø
                { id: 1, name: '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£', code: 'NUTRITION', building: 'CHALERM', floor: '1', type: 'service', x: 50, y: 50, note: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢', voice: '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 1 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 2, name: '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå', code: 'MEDICAL', building: 'CHALERM', floor: 'M', type: 'service', x: 30, y: 40, note: '', voice: '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô M ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 3, name: '‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢', code: 'RESEARCH', building: 'CHALERM', floor: 'M', type: 'service', x: 60, y: 40, note: '', voice: '‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢ ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô M ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 4, name: '‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£', code: 'CANTEEN', building: 'CHALERM', floor: '2', type: 'food', x: 50, y: 50, note: '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏≠‡∏≤‡∏´‡∏≤‡∏£', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 2 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 5, name: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 3', code: 'PARK3', building: 'CHALERM', floor: '3', type: 'parking', x: 50, y: 50, note: '', voice: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 3' },
                { id: 6, name: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 4', code: 'PARK4', building: 'CHALERM', floor: '4', type: 'parking', x: 50, y: 50, note: '', voice: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 4' },
                { id: 7, name: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 5', code: 'PARK5', building: 'CHALERM', floor: '5', type: 'parking', x: 50, y: 50, note: '', voice: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 5' },
                { id: 8, name: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 6', code: 'PARK6', building: 'CHALERM', floor: '6', type: 'parking', x: 50, y: 50, note: '', voice: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 6' },
                { id: 9, name: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 7', code: 'PARK7', building: 'CHALERM', floor: '7', type: 'parking', x: 50, y: 50, note: '', voice: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 7' },
                { id: 10, name: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 8', code: 'PARK8', building: 'CHALERM', floor: '8', type: 'parking', x: 50, y: 50, note: '', voice: '‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ‡∏ä‡∏±‡πâ‡∏ô 8' },
                // ‡∏ä‡∏±‡πâ‡∏ô 9
                { id: 11, name: '‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•', code: 'NURSING', building: 'CHALERM', floor: '9', type: 'service', x: 20, y: 30, note: '', voice: '‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 9 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 12, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° GSR', code: 'GSR', building: 'CHALERM', floor: '9', type: 'conference', x: 25, y: 45, note: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏°‡πà', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° GSR ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 9 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 13, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° SC', code: 'SC', building: 'CHALERM', floor: '9', type: 'conference', x: 35, y: 45, note: '', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° SC ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 9 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 14, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC1', code: 'VC1', building: 'CHALERM', floor: '9', type: 'conference', x: 45, y: 45, note: '', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC1 ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 9 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 15, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC2', code: 'VC2', building: 'CHALERM', floor: '9', type: 'conference', x: 55, y: 45, note: '', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC2 ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 9 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 16, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC3', code: 'VC3', building: 'CHALERM', floor: '9', type: 'conference', x: 65, y: 45, note: '', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC3 ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 9 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 17, name: '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏ß‡∏ä‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (‡∏Ç‡∏≠‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤)', code: 'MED_REC', building: 'CHALERM', floor: '9', type: 'service', x: 75, y: 50, note: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏ü‡∏ï‡πå‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏ß‡∏Ç‡∏ß‡∏≤', voice: '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏ß‡∏ä‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‡∏Ç‡∏≠‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 9 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏ü‡∏ï‡πå‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏ß‡∏Ç‡∏ß‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö' },
                // ‡∏ä‡∏±‡πâ‡∏ô 10
                { id: 18, name: '‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå', code: 'MED_ENG', building: 'CHALERM', floor: '10', type: 'service', x: 50, y: 50, note: '', voice: '‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 10 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                // ‡∏ä‡∏±‡πâ‡∏ô 11 - ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° 6 ‡∏´‡πâ‡∏≠‡∏á
                { id: 19, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÇ‡∏¢‡∏ò‡∏µ', code: 'YOTHI', building: 'CHALERM', floor: '11', type: 'conference', x: 20, y: 35, note: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ 100 ‡∏Ñ‡∏ô', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÇ‡∏¢‡∏ò‡∏µ ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 11 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ 100 ‡∏Ñ‡∏ô' },
                { id: 20, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏£‡∏≤‡∏ä‡∏û‡∏§‡∏Å‡∏©‡πå', code: 'RATCHAPHRUEK', building: 'CHALERM', floor: '11', type: 'conference', x: 35, y: 35, note: '', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏£‡∏≤‡∏ä‡∏û‡∏§‡∏Å‡∏©‡πå ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 11 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 21, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏¥‡∏Å‡∏≤‡∏£‡πå', code: 'SUPHANNIKA', building: 'CHALERM', floor: '11', type: 'conference', x: 50, y: 35, note: '', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏¥‡∏Å‡∏≤‡∏£‡πå ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 11 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 22, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏ç‡∏≤‡πÑ‡∏ó', code: 'PHAYATHAI', building: 'CHALERM', floor: '11', type: 'conference', x: 65, y: 35, note: '', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏ç‡∏≤‡πÑ‡∏ó ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 11 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 23, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏õ‡∏≤‡∏£‡∏¥‡∏ä‡∏≤‡∏ï‡∏¥', code: 'PARICHAT', building: 'CHALERM', floor: '11', type: 'conference', x: 35, y: 60, note: '', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏õ‡∏≤‡∏£‡∏¥‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 11 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                { id: 24, name: '‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£', code: 'VIP', building: 'CHALERM', floor: '11', type: 'service', x: 55, y: 60, note: '', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£ ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 11 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥' },
                // ‡∏ä‡∏±‡πâ‡∏ô 12
                { id: 25, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏¥‡∏ö‡∏π‡∏•‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°', code: 'PHIBUN', building: 'CHALERM', floor: '12', type: 'conference', x: 50, y: 45, note: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ 200 ‡∏Ñ‡∏ô', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏¥‡∏ö‡∏π‡∏•‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏° ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 12 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ 200 ‡∏Ñ‡∏ô' },
                // ‡∏ï‡∏∂‡∏Å E
                { id: 26, name: '‡∏´‡πâ‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (ER)', code: 'ER', building: 'E', floor: '1', type: 'er', x: 50, y: 50, note: '‡πÄ‡∏õ‡∏¥‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á', voice: '‡∏´‡πâ‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 1 ‡∏ï‡∏∂‡∏Å‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡∏∞‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á' }
            ];
            saveToStorage();
        }

        // ==================== IMPORT/EXPORT ====================
        function exportData() {
            const blob = new Blob([JSON.stringify({ locations, floorImages, exportedAt: new Date().toISOString() }, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `hospital-map-${new Date().toISOString().slice(0,10)}.json`;
            link.click();
        }

        function importData() { new bootstrap.Modal(document.getElementById('importModal')).show(); }

        function doImport() {
            try {
                const data = JSON.parse(document.getElementById('import-json').value);
                if (data.locations) locations = data.locations;
                if (data.floorImages) floorImages = data.floorImages;
                saveToStorage();
                render();
                renderFloorTabs();
                updateMapImage();
                bootstrap.Modal.getInstance(document.getElementById('importModal')).hide();
                alert('‚úÖ Import ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            } catch (e) { alert('‚ùå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); }
        }
    </script>
</body>
</html>
