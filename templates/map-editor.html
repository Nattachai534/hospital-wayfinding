<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üó∫Ô∏è Map Editor - ‡∏£‡∏û.‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        * { font-family: 'Sarabun', sans-serif; }
        :root { --pink: #e91e8c; --pink-light: #fce4f1; }
        body { background: #f0f0f0; margin: 0; padding: 15px; }
        
        .header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 15px; flex-wrap: wrap; gap: 10px;
            background: white; padding: 15px; border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h5 { margin: 0; color: var(--pink); }
        
        .main-layout { display: flex; gap: 15px; }
        .map-section { flex: 1; min-width: 0; }
        .control-section { width: 380px; flex-shrink: 0; }
        
        @media (max-width: 1200px) {
            .main-layout { flex-direction: column; }
            .control-section { width: 100%; }
        }
        
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 15px; overflow: hidden; }
        .card-header { background: linear-gradient(135deg, var(--pink), #f06ebc); color: white; padding: 12px 15px; font-weight: 600; }
        .card-body { padding: 15px; }
        
        .floor-tabs { display: flex; flex-wrap: wrap; gap: 5px; max-height: 80px; overflow-y: auto; padding: 5px 0; }
        .floor-tab { padding: 6px 12px; border: 2px solid #ddd; border-radius: 8px; background: white; cursor: pointer; font-weight: 600; font-size: 13px; }
        .floor-tab:hover { border-color: var(--pink); background: var(--pink-light); }
        .floor-tab.active { background: var(--pink); color: white; border-color: var(--pink); }
        .floor-tab.has-data { background: #d4edda; border-color: #28a745; }
        .floor-tab.has-data.active { background: var(--pink); }
        
        .map-container { position: relative; border: 3px solid #ddd; border-radius: 10px; overflow: hidden; background: #fafafa; min-height: 500px; }
        .map-container.drag-over { border-color: var(--pink); background: var(--pink-light); }
        .map-image { width: 100%; display: block; cursor: crosshair; }
        .markers-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        .upload-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .upload-overlay.show { display: flex; }
        .upload-overlay i { font-size: 48px; color: #ccc; margin-bottom: 15px; }
        .upload-overlay:hover i { color: var(--pink); }
        
        .marker { position: absolute; width: 36px; height: 36px; background: var(--pink); border: 3px solid white; border-radius: 50%; transform: translate(-50%, -50%); cursor: grab; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; pointer-events: auto; box-shadow: 0 3px 10px rgba(0,0,0,0.3); z-index: 100; transition: transform 0.1s; }
        .marker:hover { transform: translate(-50%, -50%) scale(1.15); z-index: 200; }
        .marker.selected { border-color: #ffc107; box-shadow: 0 0 0 4px rgba(255,193,7,0.5), 0 3px 10px rgba(0,0,0,0.3); }
        .marker.dragging { cursor: grabbing; opacity: 0.8; }
        
        .marker.entrance { background: #28a745; }
        .marker.lift { background: #fd7e14; }
        .marker.stairs { background: #20c997; }
        .marker.conference { background: #6f42c1; }
        .marker.er { background: #dc3545; }
        .marker.opd { background: #17a2b8; }
        .marker.service { background: #6c757d; }
        .marker.restroom { background: #795548; }
        .marker.pharmacy { background: #4caf50; }
        .marker.cashier { background: #ff9800; }
        .marker.lab { background: #9c27b0; }
        .marker.xray { background: #00bcd4; }
        
        .marker-label { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 3px 10px; border-radius: 6px; font-size: 11px; white-space: nowrap; margin-top: 8px; pointer-events: none; }
        
        .stats-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .stat-box { flex: 1; text-align: center; padding: 12px; background: #f8f9fa; border-radius: 10px; }
        .stat-value { font-size: 24px; font-weight: 700; color: var(--pink); }
        .stat-label { font-size: 11px; color: #666; }
        
        .location-list { max-height: 250px; overflow-y: auto; }
        .location-item { display: flex; align-items: center; padding: 10px; border: 2px solid #eee; border-radius: 10px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
        .location-item:hover { background: #f8f9fa; border-color: var(--pink); }
        .location-item.selected { background: var(--pink-light); border-color: var(--pink); }
        
        .loc-icon { width: 36px; height: 36px; border-radius: 50%; background: var(--pink); color: white; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 14px; flex-shrink: 0; }
        .loc-info { flex: 1; min-width: 0; }
        .loc-name { font-weight: 600; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .loc-detail { font-size: 11px; color: #666; }
        .loc-actions { display: flex; gap: 5px; }
        .loc-actions .btn { padding: 4px 8px; font-size: 12px; }
        
        .type-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .type-btn { padding: 8px 5px; border: 2px solid #eee; border-radius: 8px; background: white; cursor: pointer; text-align: center; font-size: 11px; transition: all 0.2s; }
        .type-btn:hover { border-color: var(--pink); }
        .type-btn.selected { background: var(--pink); color: white; border-color: var(--pink); }
        .type-btn i { display: block; font-size: 16px; margin-bottom: 3px; }
        
        .btn-pink { background: var(--pink); border-color: var(--pink); color: white; }
        .btn-pink:hover { background: #d81b7a; border-color: #d81b7a; color: white; }
        
        .qr-container { text-align: center; padding: 20px; }
        .qr-info { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; text-align: left; }
        
        .coords-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 10px 25px; border-radius: 25px; font-size: 13px; z-index: 1000; }
        
        .empty-state { text-align: center; padding: 30px; color: #999; }
        .empty-state i { font-size: 48px; margin-bottom: 15px; opacity: 0.3; }
    </style>
</head>
<body>
    <div class="header">
        <h5><i class="fas fa-map-marked-alt me-2"></i>Map Editor - ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</h5>
        <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-outline-success btn-sm" onclick="exportData()"><i class="fas fa-download me-1"></i>Export</button>
            <button class="btn btn-outline-primary btn-sm" onclick="importData()"><i class="fas fa-upload me-1"></i>Import</button>
            <a href="/" class="btn btn-outline-secondary btn-sm"><i class="fas fa-home me-1"></i>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
            <a href="/admin" class="btn btn-outline-secondary btn-sm"><i class="fas fa-cog me-1"></i>Admin</a>
        </div>
    </div>
    
    <div class="main-layout">
        <div class="map-section">
            <div class="card">
                <div class="card-header"><i class="fas fa-building me-2"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡πâ‡∏ô</div>
                <div class="card-body">
                    <div class="d-flex gap-2 mb-3">
                        <select class="form-select" id="building-select" onchange="onBuildingChange()"></select>
                        <button class="btn btn-outline-secondary" onclick="uploadFloorPlan()"><i class="fas fa-image me-1"></i>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Floor Plan</button>
                        <input type="file" id="floor-plan-input" accept="image/*" hidden onchange="handleFloorPlanUpload(event)">
                    </div>
                    <div class="floor-tabs" id="floor-tabs"></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body p-0">
                    <div class="map-container" id="map-container" ondragover="onDragOver(event)" ondragleave="onDragLeave(event)" ondrop="onDropFloorPlan(event)">
                        <img src="" class="map-image" id="map-image" onclick="onMapClick(event)">
                        <div class="markers-layer" id="markers-layer"></div>
                        <div class="upload-overlay show" id="upload-overlay" onclick="uploadFloorPlan()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <div class="text-muted">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Floor Plan</div>
                            <div class="text-muted small mt-2">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG, GIF</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted"><i class="fas fa-info-circle me-1"></i>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î | ‡∏•‡∏≤‡∏Å marker ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢</small>
                <button class="btn btn-outline-danger btn-sm" onclick="clearFloorMarkers()"><i class="fas fa-trash me-1"></i>‡∏•‡∏ö marker ‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</button>
            </div>
        </div>
        
        <div class="control-section">
            <div class="stats-row">
                <div class="stat-box"><div class="stat-value" id="stat-total">0</div><div class="stat-label">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div></div>
                <div class="stat-box"><div class="stat-value" id="stat-building">0</div><div class="stat-label">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ô‡∏µ‡πâ</div></div>
                <div class="stat-box"><div class="stat-value" id="stat-floor">0</div><div class="stat-label">‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</div></div>
            </div>
            
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center"><span><i class="fas fa-list me-2"></i>‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</span><span class="badge bg-light text-dark" id="loc-count">0</span></div>
                <div class="card-body"><div class="location-list" id="location-list"></div></div>
            </div>
            
            <div class="card">
                <div class="card-header"><i class="fas fa-plus-circle me-2"></i><span id="form-title">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà</span></div>
                <div class="card-body">
                    <form id="location-form" onsubmit="onFormSubmit(event)">
                        <div class="row mb-2">
                            <div class="col-8"><input type="text" class="form-control form-control-sm" id="inp-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏∏‡∏î *" required></div>
                            <div class="col-4"><input type="text" class="form-control form-control-sm" id="inp-code" placeholder="‡∏£‡∏´‡∏±‡∏™ *" required></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6"><input type="number" class="form-control form-control-sm" id="inp-x" placeholder="X %" step="0.1" required></div>
                            <div class="col-6"><input type="number" class="form-control form-control-sm" id="inp-y" placeholder="Y %" step="0.1" required></div>
                        </div>
                        <div class="mb-3"><label class="form-label small fw-bold">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><div class="type-grid" id="type-grid"></div></div>
                        <div class="mb-3"><input type="text" class="form-control form-control-sm" id="inp-note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)"></div>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-pink flex-fill" id="btn-submit"><i class="fas fa-plus me-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="resetForm()" id="btn-cancel" style="display:none;"><i class="fas fa-times"></i></button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header"><i class="fas fa-qrcode me-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</div>
                <div class="card-body">
                    <p class="text-muted small mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</p>
                    <button class="btn btn-outline-primary btn-sm w-100" id="btn-generate-qr" onclick="generateQR()" disabled><i class="fas fa-qrcode me-1"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</button>
                    <button class="btn btn-outline-success btn-sm w-100 mt-2" onclick="generateAllQR()"><i class="fas fa-file-archive me-1"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ)</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="coords-bar" id="coords-bar"><i class="fas fa-crosshairs me-2"></i><span id="coords-text">X: --, Y: --</span><span class="mx-2">|</span><span id="coords-building">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£: --</span><span class="mx-2">|</span><span id="coords-floor">‡∏ä‡∏±‡πâ‡∏ô: --</span></div>
    
    <div class="modal fade" id="qrModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title"><i class="fas fa-qrcode me-2"></i>QR Code</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body"><div class="qr-container"><div id="qr-code"></div><div class="qr-info" id="qr-info"></div></div></div>
                <div class="modal-footer">
                    <button class="btn btn-outline-secondary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                    <button class="btn btn-primary" onclick="downloadQR()"><i class="fas fa-download me-1"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
                    <button class="btn btn-success" onclick="printQR()"><i class="fas fa-print me-1"></i>‡∏û‡∏¥‡∏°‡∏û‡πå</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="importModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title"><i class="fas fa-upload me-2"></i>Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body"><textarea class="form-control" id="import-json" rows="10" placeholder="‡∏ß‡∏≤‡∏á JSON ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea></div>
                <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button class="btn btn-primary" onclick="doImport()">Import</button></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const BUILDINGS = [
            { code: 'A', name: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏®‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ò‡∏¥‡∏£‡∏≤‡∏ä', shortName: '‡∏ó‡∏®‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ò‡∏¥‡∏£‡∏≤‡∏ä', floors: 25 },
            { code: 'B', name: '‡∏ï‡∏∂‡∏Å‡∏™‡∏¥‡∏£‡∏¥‡∏ô‡∏ò‡∏£', shortName: '‡∏™‡∏¥‡∏£‡∏¥‡∏ô‡∏ò‡∏£', floors: 18 },
            { code: 'CHALERM', name: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏Ø', shortName: '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏Ø', floors: 12 },
            { code: 'D', name: '‡∏ï‡∏∂‡∏Å‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£', shortName: '‡∏ï‡∏∂‡∏Å D', floors: 5 },
            { code: 'E', name: '‡∏ï‡∏∂‡∏Å‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡∏∞‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô EMS', shortName: '‡∏ï‡∏∂‡∏Å E (ER)', floors: 4 },
            { code: 'F', name: '‡∏ï‡∏∂‡∏Å‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°', shortName: '‡∏ï‡∏∂‡∏Å F', floors: 6 },
            { code: 'G', name: '‡∏ï‡∏∂‡∏Å‡∏™‡∏≠‡∏≤‡∏î ‡∏®‡∏¥‡∏£‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå', shortName: '‡∏™‡∏≠‡∏≤‡∏î ‡∏®‡∏¥‡∏£‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå', floors: 8 },
            { code: 'H', name: '‡∏ï‡∏∂‡∏Å‡∏´‡∏•‡∏ß‡∏á‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡πÄ‡∏ô‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', shortName: '‡∏´‡∏•‡∏ß‡∏á‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Ø', floors: 6 },
            { code: 'I', name: '‡∏ï‡∏∂‡∏Å‡πÄ‡∏à‡∏£‡∏¥‡∏ç ‡∏û‡∏π‡∏•‡∏ß‡∏£‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå', shortName: '‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏Ø', floors: 5 },
            { code: 'J', name: '‡∏ï‡∏∂‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à', shortName: '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏±‡∏ß‡πÉ‡∏à', floors: 4 },
            { code: 'K', name: '‡∏ï‡∏∂‡∏Å‡∏ß‡∏≤‡∏®‡∏≠‡∏∏‡∏ó‡∏¥‡∏®', shortName: '‡∏ß‡∏≤‡∏®‡∏≠‡∏∏‡∏ó‡∏¥‡∏®', floors: 3 }
        ];
        
        const LOCATION_TYPES = [
            { code: 'entrance', name: '‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤', icon: 'door-open', color: '#28a745' },
            { code: 'lobby', name: '‡πÇ‡∏ñ‡∏á', icon: 'building', color: '#007bff' },
            { code: 'lift', name: '‡∏•‡∏¥‡∏ü‡∏ï‡πå', icon: 'elevator', color: '#fd7e14' },
            { code: 'stairs', name: '‡∏ö‡∏±‡∏ô‡πÑ‡∏î', icon: 'stairs', color: '#20c997' },
            { code: 'conference', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°', icon: 'users', color: '#6f42c1' },
            { code: 'er', name: '‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô', icon: 'ambulance', color: '#dc3545' },
            { code: 'opd', name: 'OPD', icon: 'hospital', color: '#17a2b8' },
            { code: 'service', name: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', icon: 'concierge-bell', color: '#6c757d' },
            { code: 'restroom', name: '‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥', icon: 'restroom', color: '#795548' },
            { code: 'pharmacy', name: '‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤', icon: 'pills', color: '#4caf50' },
            { code: 'cashier', name: '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', icon: 'cash-register', color: '#ff9800' },
            { code: 'lab', name: 'Lab', icon: 'flask', color: '#9c27b0' },
            { code: 'xray', name: 'X-Ray', icon: 'x-ray', color: '#00bcd4' },
            { code: 'room', name: '‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ', icon: 'door-closed', color: '#e91e8c' }
        ];
        
        let currentBuilding = 'CHALERM', currentFloor = '11', locations = [], floorImages = {}, selectedId = null, editingId = null, selectedType = 'room', isDragging = false, dragMarker = null;
        
        document.addEventListener('DOMContentLoaded', () => { loadFromStorage(); initUI(); render(); });
        
        function initUI() {
            document.getElementById('building-select').innerHTML = BUILDINGS.map(b => `<option value="${b.code}">${b.name} (${b.floors} ‡∏ä‡∏±‡πâ‡∏ô)</option>`).join('');
            document.getElementById('building-select').value = currentBuilding;
            renderTypeGrid(); renderFloorTabs(); updateMapImage();
            document.getElementById('map-container').addEventListener('mousemove', (e) => {
                const img = document.getElementById('map-image'), rect = img.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width * 100).toFixed(1), y = ((e.clientY - rect.top) / rect.height * 100).toFixed(1);
                document.getElementById('coords-text').textContent = `X: ${x}%, Y: ${y}%`;
                const bld = BUILDINGS.find(b => b.code === currentBuilding);
                document.getElementById('coords-building').textContent = bld?.shortName || currentBuilding;
                document.getElementById('coords-floor').textContent = `‡∏ä‡∏±‡πâ‡∏ô ${currentFloor}`;
            });
            document.addEventListener('mousemove', onDragMove);
            document.addEventListener('mouseup', onDragEnd);
        }
        
        function renderTypeGrid() {
            document.getElementById('type-grid').innerHTML = LOCATION_TYPES.map(t => `<div class="type-btn ${selectedType === t.code ? 'selected' : ''}" onclick="selectType('${t.code}')"><i class="fas fa-${t.icon}" style="color: ${selectedType === t.code ? 'white' : t.color};"></i>${t.name}</div>`).join('');
        }
        
        function selectType(type) { selectedType = type; renderTypeGrid(); }
        
        function onBuildingChange() { currentBuilding = document.getElementById('building-select').value; currentFloor = '1'; renderFloorTabs(); updateMapImage(); render(); }
        
        function renderFloorTabs() {
            const bld = BUILDINGS.find(b => b.code === currentBuilding), maxFloor = bld?.floors || 25;
            const floors = ['B1', 'G']; for (let i = 1; i <= maxFloor; i++) floors.push(i.toString());
            document.getElementById('floor-tabs').innerHTML = floors.map(f => {
                const hasData = locations.some(l => l.building === currentBuilding && l.floor === f);
                return `<div class="floor-tab ${f === currentFloor ? 'active' : ''} ${hasData && f !== currentFloor ? 'has-data' : ''}" onclick="selectFloor('${f}')">${f}</div>`;
            }).join('');
        }
        
        function selectFloor(floor) { currentFloor = floor; selectedId = editingId = null; resetForm(); renderFloorTabs(); updateMapImage(); render(); }
        
        function updateMapImage() {
            const key = `${currentBuilding}_${currentFloor}`, img = document.getElementById('map-image'), overlay = document.getElementById('upload-overlay');
            if (floorImages[key]) { img.src = floorImages[key]; overlay.classList.remove('show'); }
            else { img.src = `/static/images/maps/campus-map.jpg`; overlay.classList.add('show'); }
        }
        
        function uploadFloorPlan() { document.getElementById('floor-plan-input').click(); }
        function handleFloorPlanUpload(event) { const file = event.target.files[0]; if (file) processFloorPlanFile(file); }
        function onDragOver(event) { event.preventDefault(); document.getElementById('map-container').classList.add('drag-over'); }
        function onDragLeave(event) { document.getElementById('map-container').classList.remove('drag-over'); }
        function onDropFloorPlan(event) { event.preventDefault(); document.getElementById('map-container').classList.remove('drag-over'); const file = event.dataTransfer.files[0]; if (file && file.type.startsWith('image/')) processFloorPlanFile(file); }
        function processFloorPlanFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => { floorImages[`${currentBuilding}_${currentFloor}`] = e.target.result; updateMapImage(); saveToStorage(); alert(`‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Floor Plan ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`); };
            reader.readAsDataURL(file);
        }
        
        function render() { renderMarkers(); renderLocationList(); updateStats(); }
        
        function renderMarkers() {
            const layer = document.getElementById('markers-layer'), floorLocs = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor);
            layer.innerHTML = floorLocs.map(loc => {
                const type = LOCATION_TYPES.find(t => t.code === loc.type) || LOCATION_TYPES[13];
                return `<div class="marker ${loc.type} ${selectedId === loc.id ? 'selected' : ''}" style="left: ${loc.x}%; top: ${loc.y}%; background: ${type.color};" data-id="${loc.id}" onmousedown="onDragStart(event, ${loc.id})" onclick="selectLocation(${loc.id})"><i class="fas fa-${type.icon}"></i><div class="marker-label">${loc.name}</div></div>`;
            }).join('');
        }
        
        function renderLocationList() {
            const list = document.getElementById('location-list'), floorLocs = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor);
            document.getElementById('loc-count').textContent = floorLocs.length;
            if (!floorLocs.length) { list.innerHTML = `<div class="empty-state"><i class="fas fa-map-marker-alt"></i><div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</div><div class="small">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°</div></div>`; return; }
            list.innerHTML = floorLocs.map(loc => {
                const type = LOCATION_TYPES.find(t => t.code === loc.type) || LOCATION_TYPES[13];
                return `<div class="location-item ${selectedId === loc.id ? 'selected' : ''}" onclick="selectLocation(${loc.id})"><div class="loc-icon" style="background: ${type.color};"><i class="fas fa-${type.icon}"></i></div><div class="loc-info"><div class="loc-name">${loc.name}</div><div class="loc-detail">${loc.code} | X:${loc.x.toFixed(1)}% Y:${loc.y.toFixed(1)}%</div></div><div class="loc-actions"><button class="btn btn-outline-primary btn-sm" onclick="event.stopPropagation(); showQR(${loc.id})"><i class="fas fa-qrcode"></i></button><button class="btn btn-outline-danger btn-sm" onclick="event.stopPropagation(); deleteLocation(${loc.id})"><i class="fas fa-trash"></i></button></div></div>`;
            }).join('');
        }
        
        function updateStats() {
            document.getElementById('stat-total').textContent = locations.length;
            document.getElementById('stat-building').textContent = locations.filter(l => l.building === currentBuilding).length;
            document.getElementById('stat-floor').textContent = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor).length;
        }
        
        function onMapClick(event) {
            if (isDragging) return;
            const img = event.target, rect = img.getBoundingClientRect();
            document.getElementById('inp-x').value = ((event.clientX - rect.left) / rect.width * 100).toFixed(1);
            document.getElementById('inp-y').value = ((event.clientY - rect.top) / rect.height * 100).toFixed(1);
            document.getElementById('inp-name').focus();
        }
        
        function onDragStart(event, id) { event.preventDefault(); event.stopPropagation(); isDragging = true; dragMarker = id; selectLocation(id); }
        function onDragMove(event) {
            if (!isDragging || !dragMarker) return;
            const img = document.getElementById('map-image'), rect = img.getBoundingClientRect();
            let x = Math.max(0, Math.min(100, (event.clientX - rect.left) / rect.width * 100));
            let y = Math.max(0, Math.min(100, (event.clientY - rect.top) / rect.height * 100));
            const loc = locations.find(l => l.id === dragMarker);
            if (loc) { loc.x = x; loc.y = y; document.getElementById('inp-x').value = x.toFixed(1); document.getElementById('inp-y').value = y.toFixed(1); const marker = document.querySelector(`.marker[data-id="${dragMarker}"]`); if (marker) { marker.style.left = x + '%'; marker.style.top = y + '%'; } }
        }
        function onDragEnd() { if (isDragging) { isDragging = false; dragMarker = null; renderLocationList(); saveToStorage(); } }
        
        function onFormSubmit(event) {
            event.preventDefault();
            const data = { name: document.getElementById('inp-name').value.trim(), code: document.getElementById('inp-code').value.trim().toUpperCase(), x: parseFloat(document.getElementById('inp-x').value), y: parseFloat(document.getElementById('inp-y').value), type: selectedType, building: currentBuilding, floor: currentFloor, note: document.getElementById('inp-note').value.trim() };
            if (editingId) { const loc = locations.find(l => l.id === editingId); if (loc) Object.assign(loc, data); }
            else { data.id = locations.length ? Math.max(...locations.map(l => l.id)) + 1 : 1; locations.push(data); }
            resetForm(); render(); saveToStorage();
        }
        
        function selectLocation(id) {
            selectedId = id; const loc = locations.find(l => l.id === id);
            if (loc) { document.getElementById('inp-name').value = loc.name; document.getElementById('inp-code').value = loc.code; document.getElementById('inp-x').value = loc.x.toFixed(1); document.getElementById('inp-y').value = loc.y.toFixed(1); document.getElementById('inp-note').value = loc.note || ''; selectedType = loc.type; renderTypeGrid(); editingId = id; document.getElementById('form-title').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î'; document.getElementById('btn-submit').innerHTML = '<i class="fas fa-save me-1"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'; document.getElementById('btn-cancel').style.display = 'block'; document.getElementById('btn-generate-qr').disabled = false; }
            render();
        }
        
        function deleteLocation(id) { const loc = locations.find(l => l.id === id); if (loc && confirm(`‡∏•‡∏ö "${loc.name}" ?`)) { locations = locations.filter(l => l.id !== id); if (selectedId === id || editingId === id) resetForm(); render(); saveToStorage(); } }
        
        function resetForm() { document.getElementById('location-form').reset(); document.getElementById('form-title').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà'; document.getElementById('btn-submit').innerHTML = '<i class="fas fa-plus me-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°'; document.getElementById('btn-cancel').style.display = 'none'; document.getElementById('btn-generate-qr').disabled = true; selectedId = editingId = null; selectedType = 'room'; renderTypeGrid(); render(); }
        
        function clearFloorMarkers() { const count = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor).length; if (!count) { alert('‡πÑ‡∏°‡πà‡∏°‡∏µ marker ‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ'); return; } if (confirm(`‡∏•‡∏ö marker ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${count} ‡∏à‡∏∏‡∏î?`)) { locations = locations.filter(l => !(l.building === currentBuilding && l.floor === currentFloor)); resetForm(); render(); saveToStorage(); } }
        
        function generateQR() { if (selectedId) showQR(selectedId); }
        
        function showQR(id) {
            const loc = locations.find(l => l.id === id); if (!loc) return;
            const bld = BUILDINGS.find(b => b.code === loc.building), qrUrl = `${window.location.origin}/navigate?building=${loc.building}&floor=${loc.floor}&room=${loc.code}&dest=${encodeURIComponent(loc.name)}`;
            document.getElementById('qr-code').innerHTML = '';
            new QRCode(document.getElementById('qr-code'), { text: qrUrl, width: 200, height: 200, correctLevel: QRCode.CorrectLevel.H });
            document.getElementById('qr-info').innerHTML = `<p class="mb-1"><strong>${loc.name}</strong></p><p class="mb-1 small">${bld?.name || loc.building} ‡∏ä‡∏±‡πâ‡∏ô ${loc.floor}</p><p class="mb-1 small text-muted">‡∏£‡∏´‡∏±‡∏™: ${loc.code}</p><hr><p class="mb-0 small text-break">${qrUrl}</p>`;
            window.currentQRLocation = loc;
            new bootstrap.Modal(document.getElementById('qrModal')).show();
        }
        
        function downloadQR() { const loc = window.currentQRLocation; if (!loc) return; const canvas = document.querySelector('#qr-code canvas'); if (canvas) { const link = document.createElement('a'); link.download = `QR_${loc.building}_${loc.floor}_${loc.code}.png`; link.href = canvas.toDataURL('image/png'); link.click(); } }
        
        function printQR() {
            const loc = window.currentQRLocation; if (!loc) return;
            const bld = BUILDINGS.find(b => b.code === loc.building), canvas = document.querySelector('#qr-code canvas');
            if (canvas) { const pw = window.open('', '_blank'); pw.document.write(`<!DOCTYPE html><html><head><title>QR - ${loc.name}</title><style>body{font-family:sans-serif;text-align:center;padding:40px;}img{margin:20px 0;}.loc{font-size:24px;font-weight:bold;}</style></head><body><h2>üè• ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</h2><p>‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏ó‡∏≤‡∏á</p><img src="${canvas.toDataURL('image/png')}" width="250"><div class="loc">${loc.name}</div><p>${bld?.name} ‡∏ä‡∏±‡πâ‡∏ô ${loc.floor}</p></body></html>`); pw.document.close(); pw.print(); }
        }
        
        function generateAllQR() {
            const floorLocs = locations.filter(l => l.building === currentBuilding && l.floor === currentFloor);
            if (!floorLocs.length) { alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ'); return; }
            const bld = BUILDINGS.find(b => b.code === currentBuilding), pw = window.open('', '_blank');
            pw.document.write(`<!DOCTYPE html><html><head><title>QR - ${bld?.shortName} ‡∏ä‡∏±‡πâ‡∏ô ${currentFloor}</title><script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"><\/script><style>body{font-family:sans-serif;}.qr-card{display:inline-block;width:250px;margin:15px;padding:20px;border:2px solid #ddd;border-radius:10px;text-align:center;}h1{text-align:center;}</style></head><body><h1>üè• ${bld?.name} - ‡∏ä‡∏±‡πâ‡∏ô ${currentFloor}</h1><div id="qr-container"></div><script>const locs=${JSON.stringify(floorLocs)};const baseUrl="${window.location.origin}";locs.forEach(loc=>{const card=document.createElement('div');card.className='qr-card';const qrDiv=document.createElement('div');card.appendChild(qrDiv);const title=document.createElement('h3');title.textContent=loc.name;card.appendChild(title);const code=document.createElement('p');code.textContent='‡∏£‡∏´‡∏±‡∏™: '+loc.code;card.appendChild(code);document.getElementById('qr-container').appendChild(card);new QRCode(qrDiv,{text:baseUrl+'/navigate?building='+loc.building+'&floor='+loc.floor+'&room='+loc.code+'&dest='+encodeURIComponent(loc.name),width:150,height:150});});setTimeout(()=>window.print(),1000);<\/script></body></html>`);
            pw.document.close();
        }
        
        function saveToStorage() { localStorage.setItem('hospitalMapEditor', JSON.stringify({ locations, floorImages, currentBuilding, currentFloor })); }
        
        function loadFromStorage() {
            try { const saved = localStorage.getItem('hospitalMapEditor'); if (saved) { const data = JSON.parse(saved); locations = data.locations || []; floorImages = data.floorImages || {}; if (data.currentBuilding) currentBuilding = data.currentBuilding; if (data.currentFloor) currentFloor = data.currentFloor; } } catch (e) { console.error(e); }
            if (!locations.length) {
                locations = [
                    { id: 1, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° SC', code: 'SC', building: 'CHALERM', floor: '9', type: 'conference', x: 30, y: 40, note: '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•' },
                    { id: 2, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC1', code: 'VC1', building: 'CHALERM', floor: '9', type: 'conference', x: 40, y: 40, note: '' },
                    { id: 3, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC2', code: 'VC2', building: 'CHALERM', floor: '9', type: 'conference', x: 50, y: 40, note: '' },
                    { id: 4, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC3', code: 'VC3', building: 'CHALERM', floor: '9', type: 'conference', x: 60, y: 40, note: '' },
                    { id: 5, name: '‡∏´‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤', code: 'MED_REC', building: 'CHALERM', floor: '9', type: 'service', x: 70, y: 50, note: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏ü‡∏ï‡πå‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏ß‡∏Ç‡∏ß‡∏≤' },
                    { id: 6, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÇ‡∏¢‡∏ò‡∏µ', code: 'YOTHI', building: 'CHALERM', floor: '11', type: 'conference', x: 25, y: 35, note: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ 100 ‡∏Ñ‡∏ô' },
                    { id: 7, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏£‡∏≤‡∏ä‡∏û‡∏§‡∏Å‡∏©‡πå', code: 'RATCHAPHRUEK', building: 'CHALERM', floor: '11', type: 'conference', x: 40, y: 35, note: '' },
                    { id: 8, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏¥‡∏Å‡∏≤‡∏£‡πå', code: 'SUPHANNIKA', building: 'CHALERM', floor: '11', type: 'conference', x: 55, y: 35, note: '' },
                    { id: 9, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏ç‡∏≤‡πÑ‡∏ó', code: 'PHAYATHAI', building: 'CHALERM', floor: '11', type: 'conference', x: 70, y: 35, note: '' },
                    { id: 10, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏õ‡∏≤‡∏£‡∏¥‡∏ä‡∏≤‡∏ï‡∏¥', code: 'PARICHAT', building: 'CHALERM', floor: '11', type: 'conference', x: 40, y: 55, note: '' },
                    { id: 11, name: '‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£', code: 'VIP', building: 'CHALERM', floor: '11', type: 'service', x: 60, y: 55, note: '' },
                    { id: 12, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏¥‡∏ö‡∏π‡∏•‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°', code: 'PHIBUN', building: 'CHALERM', floor: '12', type: 'conference', x: 50, y: 45, note: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ 200 ‡∏Ñ‡∏ô' },
                    { id: 13, name: '‡∏´‡πâ‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (ER)', code: 'ER', building: 'E', floor: '1', type: 'er', x: 50, y: 50, note: '‡πÄ‡∏õ‡∏¥‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á' },
                    { id: 14, name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° EMS', code: 'EMS_CONF', building: 'E', floor: '4', type: 'conference', x: 50, y: 45, note: '' }
                ];
                saveToStorage();
            }
        }
        
        function exportData() { const data = { locations, floorImages, exportedAt: new Date().toISOString() }; const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' }); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = `hospital-map-${new Date().toISOString().slice(0,10)}.json`; link.click(); }
        function importData() { new bootstrap.Modal(document.getElementById('importModal')).show(); }
        function doImport() { try { const data = JSON.parse(document.getElementById('import-json').value); if (data.locations) locations = data.locations; if (data.floorImages) floorImages = data.floorImages; saveToStorage(); render(); renderFloorTabs(); updateMapImage(); bootstrap.Modal.getInstance(document.getElementById('importModal')).hide(); alert('‚úÖ Import ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'); } catch (e) { alert('‚ùå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); } }
    </script>
</body>
</html>
