<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á - ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        * { font-family: 'Sarabun', sans-serif; }
        :root { --pink: #e91e8c; --pink-light: #fce4f1; }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 15px;
        }
        
        .main-container { max-width: 500px; margin: 0 auto; }
        
        .header-card {
            background: white; border-radius: 20px; padding: 20px;
            text-align: center; margin-bottom: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .hospital-logo { width: 70px; margin-bottom: 10px; }
        .hospital-name { font-size: 22px; font-weight: 700; color: var(--pink); }
        .hospital-name-en { font-size: 11px; color: #666; }
        
        .content-card {
            background: white; border-radius: 20px; padding: 20px;
            margin-bottom: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .section-title {
            font-weight: 600; color: #333; margin-bottom: 12px;
            display: flex; align-items: center; gap: 8px; font-size: 15px;
        }
        .section-title i { color: var(--pink); }
        
        .building-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
        
        .building-card {
            padding: 12px; border: 2px solid #eee; border-radius: 12px;
            cursor: pointer; transition: all 0.2s; text-align: center;
        }
        .building-card:hover { border-color: var(--pink); background: var(--pink-light); }
        .building-card.selected { border-color: var(--pink); background: var(--pink-light); }
        
        .building-icon {
            width: 40px; height: 40px; border-radius: 10px;
            background: var(--pink); color: white;
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 8px; font-size: 18px;
        }
        .building-card.er .building-icon { background: #dc3545; }
        .building-card.opd .building-icon { background: #28a745; }
        .building-card.heart .building-icon { background: #e91e8c; }
        
        .building-name { font-weight: 600; font-size: 12px; color: #333; }
        .building-floors { font-size: 10px; color: #666; }
        
        .floor-section { display: none; margin-bottom: 15px; }
        .floor-section.show { display: block; }
        
        .floor-grid { display: flex; flex-wrap: wrap; gap: 6px; }
        .floor-btn {
            padding: 8px 12px; border: 2px solid #eee; border-radius: 8px;
            background: white; cursor: pointer; font-weight: 600; font-size: 13px;
            min-width: 40px; text-align: center;
        }
        .floor-btn:hover { border-color: var(--pink); }
        .floor-btn.selected { background: var(--pink); color: white; border-color: var(--pink); }
        
        .room-section { display: none; margin-bottom: 15px; }
        .room-section.show { display: block; }
        
        .room-list { max-height: 200px; overflow-y: auto; }
        .room-item {
            display: flex; align-items: center; padding: 10px;
            border: 1px solid #eee; border-radius: 10px; margin-bottom: 6px;
            cursor: pointer; transition: all 0.2s;
        }
        .room-item:hover { background: var(--pink-light); border-color: var(--pink); }
        .room-item.selected { background: var(--pink-light); border-color: var(--pink); }
        
        .room-icon {
            width: 35px; height: 35px; border-radius: 8px;
            background: #f0f0f0; color: #666;
            display: flex; align-items: center; justify-content: center;
            margin-right: 10px; font-size: 14px;
        }
        .room-item.selected .room-icon { background: var(--pink); color: white; }
        
        .room-name { font-weight: 600; font-size: 13px; }
        .room-detail { font-size: 11px; color: #666; }
        
        .search-box { position: relative; margin-bottom: 15px; }
        .search-box input {
            width: 100%; padding: 12px 15px 12px 45px;
            border: 2px solid #eee; border-radius: 12px; font-size: 15px;
        }
        .search-box input:focus { border-color: var(--pink); outline: none; }
        .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #999; }
        
        .quick-btns { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .quick-btn {
            padding: 8px 14px; border: 1px solid #eee; border-radius: 20px;
            background: white; font-size: 12px; cursor: pointer;
        }
        .quick-btn:hover { background: var(--pink); color: white; border-color: var(--pink); }
        
        .voice-toggle {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 15px; background: #f8f9fa; border-radius: 10px;
            margin-bottom: 15px;
        }
        .voice-toggle label { flex: 1; font-size: 14px; }
        .voice-toggle .form-check-input:checked { background-color: var(--pink); border-color: var(--pink); }
        
        .nav-btn {
            width: 100%; padding: 16px;
            background: linear-gradient(135deg, var(--pink), #c4177a);
            color: white; border: none; border-radius: 15px;
            font-size: 18px; font-weight: 600; cursor: pointer;
            box-shadow: 0 5px 20px rgba(233,30,140,0.4);
        }
        .nav-btn:disabled { background: #ccc; box-shadow: none; }
        .nav-btn:hover:not(:disabled) { transform: translateY(-2px); }
        
        .selected-info {
            background: var(--pink-light); padding: 12px 15px;
            border-radius: 10px; margin-bottom: 15px; display: none;
        }
        .selected-info.show { display: block; }
        .selected-info i { color: var(--pink); }
        
        .ai-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .ai-header {
            background: linear-gradient(135deg, var(--pink), #f06ebc);
            color: white; padding: 15px 20px;
            display: flex; align-items: center; gap: 10px;
        }
        .ai-header i { font-size: 24px; }
        
        .chat-messages { height: 220px; overflow-y: auto; padding: 15px; background: #f8f9fa; }
        .chat-bubble {
            max-width: 85%; padding: 10px 14px; border-radius: 15px;
            margin-bottom: 10px; font-size: 13px; line-height: 1.5;
        }
        .chat-bubble.bot { background: white; border-bottom-left-radius: 5px; }
        .chat-bubble.user { background: var(--pink); color: white; margin-left: auto; border-bottom-right-radius: 5px; }
        
        .chat-input-area {
            padding: 12px; background: white; border-top: 1px solid #eee;
            display: flex; gap: 10px;
        }
        .chat-input-area input {
            flex: 1; padding: 10px 15px; border: 2px solid #eee;
            border-radius: 25px; font-size: 14px;
        }
        .chat-input-area input:focus { border-color: var(--pink); outline: none; }
        .chat-input-area button {
            width: 42px; height: 42px; border-radius: 50%;
            background: var(--pink); color: white; border: none;
        }
        
        .footer-links {
            display: flex; justify-content: center; gap: 20px; margin-top: 15px;
        }
        .footer-links a { color: white; text-decoration: none; font-size: 12px; opacity: 0.9; }
        .footer-links a:hover { opacity: 1; }
        
        .modal-map img { width: 100%; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header-card">
            <img src="https://img2.pic.in.th/pic/logo22cedd032191e951.jpg" alt="Logo" class="hospital-logo">
            <div class="hospital-name">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</div>
            <div class="hospital-name-en">Rajavithi Hospital - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</div>
        </div>
        
        <!-- Navigation Section -->
        <div class="content-card">
            <div class="section-title">
                <i class="fas fa-route"></i>
                <span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</span>
                <button class="btn btn-sm btn-outline-secondary ms-auto" data-bs-toggle="modal" data-bs-target="#campusMapModal">
                    <i class="fas fa-map"></i>
                </button>
            </div>
            
            <!-- Search -->
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡πâ‡∏≠‡∏á / ‡πÅ‡∏ú‡∏ô‡∏Å / ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°..." oninput="onSearch(this.value)">
            </div>
            
            <!-- Quick Buttons -->
            <div class="quick-btns">
                <span class="quick-btn" onclick="quickSelect('ER', 'E', '1', '‡∏´‡πâ‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô')">üöë ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</span>
                <span class="quick-btn" onclick="quickSelect('OPD', 'CHALERM', '1', 'OPD ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å')">üè• OPD</span>
                <span class="quick-btn" onclick="quickSelect('PHARMACY', 'CHALERM', '1', '‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤')">üíä ‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤</span>
                <span class="quick-btn" onclick="quickSelect('CASHIER', 'CHALERM', '1', '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô')">üí∞ ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</span>
                <span class="quick-btn" onclick="quickSelect('CONF', 'CHALERM', '11', '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°')">üìã ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</span>
            </div>
            
            <!-- Building Selection -->
            <div class="section-title"><i class="fas fa-building"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</div>
            <div class="building-grid" id="building-grid"></div>
            
            <!-- Floor Selection -->
            <div class="floor-section" id="floor-section">
                <div class="section-title">
                    <i class="fas fa-layer-group"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô
                    <span class="badge bg-secondary ms-auto" id="selected-building-badge"></span>
                </div>
                <div class="floor-grid" id="floor-grid"></div>
            </div>
            
            <!-- Room Selection -->
            <div class="room-section" id="room-section">
                <div class="section-title">
                    <i class="fas fa-door-open"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á/‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢
                    <span class="badge bg-secondary ms-auto" id="selected-floor-badge"></span>
                </div>
                <div class="room-list" id="room-list"></div>
            </div>
            
            <!-- Voice Toggle -->
            <div class="voice-toggle">
                <i class="fas fa-volume-up text-pink"></i>
                <label>‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á</label>
                <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" id="voice-toggle" checked>
                </div>
            </div>
            
            <!-- Selected Info -->
            <div class="selected-info" id="selected-info">
                <i class="fas fa-map-marker-alt me-2"></i>
                <span id="selected-text"></span>
            </div>
            
            <!-- Navigate Button -->
            <button class="nav-btn" id="nav-btn" onclick="startNavigation()" disabled>
                <i class="fas fa-directions me-2"></i>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á
            </button>
        </div>
        
        <!-- AI Assistant -->
        <div class="ai-card">
            <div class="ai-header">
                <i class="fas fa-robot"></i>
                <div>
                    <div style="font-weight: 600;">AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ - ‡∏£‡∏û.‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</div>
                    <small style="opacity: 0.9;">‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</small>
                </div>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="chat-bubble bot">
                    <i class="fas fa-robot me-2" style="color: var(--pink);"></i>
                    ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞! üè• ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á ‡∏£‡∏û.‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ<br><br>
                    ‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏ä‡πà‡∏ô:<br>
                    ‚Ä¢ "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÇ‡∏¢‡∏ò‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏ô"<br>
                    ‚Ä¢ "‡∏´‡πâ‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏∂‡∏Å‡∏≠‡∏∞‡πÑ‡∏£"<br>
                    ‚Ä¢ "OPD ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏µ‡πà‡πÇ‡∏°‡∏á"
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="ai-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
                <button onclick="askAI()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer-links">
            <a href="/admin"><i class="fas fa-cog me-1"></i>Admin</a>
            <a href="/map-editor"><i class="fas fa-edit me-1"></i>Map Editor</a>
            <a href="tel:023548108"><i class="fas fa-phone me-1"></i>02-354-8108</a>
        </div>
    </div>
    
    <!-- Campus Map Modal -->
    <div class="modal fade" id="campusMapModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-map me-2"></i>‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body modal-map">
                    <img src="/static/images/maps/campus-map.jpg" alt="‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ==================== DATA ====================
        const BUILDINGS = [
            { code: 'A', name: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏®‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ò‡∏¥‡∏£‡∏≤‡∏ä', shortName: '‡∏ó‡∏®‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ò‡∏¥‡∏£‡∏≤‡∏ä', floors: 25, type: 'main', icon: 'hospital' },
            { code: 'B', name: '‡∏ï‡∏∂‡∏Å‡∏™‡∏¥‡∏£‡∏¥‡∏ô‡∏ò‡∏£', shortName: '‡∏™‡∏¥‡∏£‡∏¥‡∏ô‡∏ò‡∏£', floors: 18, type: 'ipd', icon: 'bed' },
            { code: 'CHALERM', name: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏Ø', shortName: '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏Ø', floors: 12, type: 'opd', icon: 'clinic-medical' },
            { code: 'D', name: '‡∏ï‡∏∂‡∏Å‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£', shortName: '‡∏ï‡∏∂‡∏Å D', floors: 5, type: 'admin', icon: 'building' },
            { code: 'E', name: '‡∏ï‡∏∂‡∏Å‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡∏∞‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô', shortName: '‡∏ï‡∏∂‡∏Å E (ER)', floors: 4, type: 'er', icon: 'ambulance' },
            { code: 'F', name: '‡∏ï‡∏∂‡∏Å‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°', shortName: '‡∏ï‡∏∂‡∏Å F', floors: 6, type: 'ipd', icon: 'user-md' },
            { code: 'G', name: '‡∏ï‡∏∂‡∏Å‡∏™‡∏≠‡∏≤‡∏î ‡∏®‡∏¥‡∏£‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå', shortName: '‡∏™‡∏≠‡∏≤‡∏î ‡∏®‡∏¥‡∏£‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå', floors: 8, type: 'heart', icon: 'heartbeat' },
            { code: 'H', name: '‡∏ï‡∏∂‡∏Å‡∏´‡∏•‡∏ß‡∏á‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Ø', shortName: '‡∏´‡∏•‡∏ß‡∏á‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Ø', floors: 6, type: 'clinic', icon: 'stethoscope' }
        ];
        
        const ROOMS = {
            'CHALERM': {
                '9': [
                    { code: 'SC', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° SC', type: 'conference' },
                    { code: 'VC1', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC1', type: 'conference' },
                    { code: 'VC2', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC2', type: 'conference' },
                    { code: 'VC3', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° VC3', type: 'conference' },
                    { code: 'MED_RECORD', name: '‡∏´‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤', type: 'service', note: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏ü‡∏ï‡πå‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏ß‡∏Ç‡∏ß‡∏≤' }
                ],
                '11': [
                    { code: 'YOTHI', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÇ‡∏¢‡∏ò‡∏µ', type: 'conference' },
                    { code: 'RATCHAPHRUEK', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏£‡∏≤‡∏ä‡∏û‡∏§‡∏Å‡∏©‡πå', type: 'conference' },
                    { code: 'SUPHANNIKA', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏¥‡∏Å‡∏≤‡∏£‡πå', type: 'conference' },
                    { code: 'PHAYATHAI', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏ç‡∏≤‡πÑ‡∏ó', type: 'conference' },
                    { code: 'PARICHAT', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏õ‡∏≤‡∏£‡∏¥‡∏ä‡∏≤‡∏ï‡∏¥', type: 'conference' },
                    { code: 'VIP_ROOM', name: '‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£', type: 'vip' }
                ],
                '12': [
                    { code: 'PHIBUN', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏û‡∏¥‡∏ö‡∏π‡∏•‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°', type: 'conference' }
                ],
                '1': [
                    { code: 'OPD_LOBBY', name: '‡πÇ‡∏ñ‡∏á OPD', type: 'lobby' },
                    { code: 'CASHIER', name: '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', type: 'service' },
                    { code: 'PHARMACY', name: '‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤', type: 'service' }
                ]
            },
            'E': {
                '1': [{ code: 'ER', name: '‡∏´‡πâ‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô', type: 'emergency', note: '‡πÄ‡∏õ‡∏¥‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á' }],
                '4': [{ code: 'EMS_CONF', name: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° EMS', type: 'conference' }]
            },
            'G': {
                '1': [{ code: 'HEART_OPD', name: '‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à', type: 'clinic' }]
            }
        };
        
        let selectedBuilding = null;
        let selectedFloor = null;
        let selectedRoom = null;
        let voiceEnabled = true;
        
        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            renderBuildings();
            document.getElementById('ai-input').addEventListener('keypress', e => {
                if (e.key === 'Enter') askAI();
            });
            document.getElementById('voice-toggle').addEventListener('change', e => {
                voiceEnabled = e.target.checked;
                if (voiceEnabled) speak('‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞');
            });
        });
        
        function renderBuildings() {
            document.getElementById('building-grid').innerHTML = BUILDINGS.map(b => `
                <div class="building-card ${b.type}" onclick="selectBuilding('${b.code}')" id="bld-${b.code}">
                    <div class="building-icon"><i class="fas fa-${b.icon}"></i></div>
                    <div class="building-name">${b.shortName}</div>
                    <div class="building-floors">${b.floors} ‡∏ä‡∏±‡πâ‡∏ô</div>
                </div>
            `).join('');
        }
        
        function selectBuilding(code) {
            selectedBuilding = BUILDINGS.find(b => b.code === code);
            selectedFloor = null; selectedRoom = null;
            
            document.querySelectorAll('.building-card').forEach(c => c.classList.remove('selected'));
            document.getElementById(`bld-${code}`).classList.add('selected');
            
            document.getElementById('floor-section').classList.add('show');
            document.getElementById('room-section').classList.remove('show');
            document.getElementById('selected-building-badge').textContent = selectedBuilding.shortName;
            
            renderFloors();
            updateSelectedInfo();
            if (voiceEnabled) speak(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å${selectedBuilding.shortName}`);
        }
        
        function renderFloors() {
            const floors = ['G'];
            for (let i = 1; i <= selectedBuilding.floors; i++) floors.push(i.toString());
            
            document.getElementById('floor-grid').innerHTML = floors.map(f => `
                <div class="floor-btn" onclick="selectFloor('${f}')" id="floor-${f}">${f}</div>
            `).join('');
        }
        
        function selectFloor(floor) {
            selectedFloor = floor; selectedRoom = null;
            
            document.querySelectorAll('.floor-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById(`floor-${floor}`).classList.add('selected');
            
            document.getElementById('room-section').classList.add('show');
            document.getElementById('selected-floor-badge').textContent = `‡∏ä‡∏±‡πâ‡∏ô ${floor}`;
            
            renderRooms();
            updateSelectedInfo();
            if (voiceEnabled) speak(`‡∏ä‡∏±‡πâ‡∏ô ${floor}`);
        }
        
        function renderRooms() {
            const rooms = ROOMS[selectedBuilding.code]?.[selectedFloor] || [];
            const list = document.getElementById('room-list');
            
            if (!rooms.length) {
                list.innerHTML = '<div class="text-center text-muted py-3">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ</div>';
                return;
            }
            
            list.innerHTML = rooms.map(r => `
                <div class="room-item" onclick="selectRoom('${r.code}')" id="room-${r.code}">
                    <div class="room-icon"><i class="fas fa-${getRoomIcon(r.type)}"></i></div>
                    <div>
                        <div class="room-name">${r.name}</div>
                        <div class="room-detail">${r.note || getRoomTypeLabel(r.type)}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function selectRoom(code) {
            const rooms = ROOMS[selectedBuilding.code]?.[selectedFloor] || [];
            selectedRoom = rooms.find(r => r.code === code);
            
            document.querySelectorAll('.room-item').forEach(i => i.classList.remove('selected'));
            document.getElementById(`room-${code}`).classList.add('selected');
            
            updateSelectedInfo();
            if (voiceEnabled) speak(selectedRoom.name);
        }
        
        function getRoomIcon(type) {
            return { conference: 'users', service: 'concierge-bell', emergency: 'ambulance', clinic: 'stethoscope', lobby: 'building', vip: 'star' }[type] || 'door-open';
        }
        
        function getRoomTypeLabel(type) {
            return { conference: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°', service: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', emergency: '‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô', clinic: '‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å', lobby: '‡πÇ‡∏ñ‡∏á', vip: '‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á' }[type] || '';
        }
        
        function quickSelect(roomCode, buildingCode, floor, name) {
            selectedBuilding = BUILDINGS.find(b => b.code === buildingCode);
            selectedFloor = floor;
            selectedRoom = { code: roomCode, name: name };
            updateSelectedInfo();
            if (voiceEnabled) speak(name);
        }
        
        function onSearch(query) {
            if (!query.trim()) return;
            const q = query.toLowerCase();
            
            for (const [buildingCode, floors] of Object.entries(ROOMS)) {
                for (const [floor, rooms] of Object.entries(floors)) {
                    for (const room of rooms) {
                        if (room.name.toLowerCase().includes(q)) {
                            selectedBuilding = BUILDINGS.find(b => b.code === buildingCode);
                            selectedFloor = floor;
                            selectedRoom = room;
                            updateSelectedInfo();
                            return;
                        }
                    }
                }
            }
        }
        
        function updateSelectedInfo() {
            const info = document.getElementById('selected-info');
            const text = document.getElementById('selected-text');
            const btn = document.getElementById('nav-btn');
            
            let parts = [];
            if (selectedBuilding) parts.push(selectedBuilding.shortName);
            if (selectedFloor) parts.push(`‡∏ä‡∏±‡πâ‡∏ô ${selectedFloor}`);
            if (selectedRoom) parts.push(selectedRoom.name);
            
            if (parts.length > 0) {
                info.classList.add('show');
                text.textContent = parts.join(' ‚Üí ');
                btn.disabled = false;
            } else {
                info.classList.remove('show');
                btn.disabled = true;
            }
        }
        
        function startNavigation() {
            const params = new URLSearchParams();
            if (selectedBuilding) params.set('building', selectedBuilding.code);
            if (selectedFloor) params.set('floor', selectedFloor);
            if (selectedRoom) {
                params.set('room', selectedRoom.code);
                params.set('dest', selectedRoom.name);
            }
            params.set('voice', voiceEnabled ? '1' : '0');
            
            if (voiceEnabled) speak(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ ${selectedRoom?.name || selectedBuilding?.shortName}`);
            window.location.href = `/navigate?${params.toString()}`;
        }
        
        function speak(text) {
            if (!voiceEnabled || !window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'th-TH';
            utterance.rate = 0.9;
            const voices = window.speechSynthesis.getVoices();
            const thaiVoice = voices.find(v => v.lang.includes('th'));
            if (thaiVoice) utterance.voice = thaiVoice;
            window.speechSynthesis.speak(utterance);
        }
        
        async function askAI() {
            const input = document.getElementById('ai-input');
            const messages = document.getElementById('chat-messages');
            const question = input.value.trim();
            if (!question) return;
            
            messages.innerHTML += `<div class="chat-bubble user">${escapeHtml(question)}</div>`;
            input.value = '';
            
            const typingId = 'typing-' + Date.now();
            messages.innerHTML += `<div class="chat-bubble bot" id="${typingId}"><i class="fas fa-spinner fa-spin me-2"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...</div>`;
            messages.scrollTop = messages.scrollHeight;
            
            try {
                const res = await fetch('/api/ai/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question })
                });
                const data = await res.json();
                
                document.getElementById(typingId)?.remove();
                messages.innerHTML += `<div class="chat-bubble bot"><i class="fas fa-robot me-2" style="color: var(--pink);"></i>${data.response}</div>`;
                messages.scrollTop = messages.scrollHeight;
                
                if (voiceEnabled) speak(data.response.replace(/<[^>]*>/g, ''));
            } catch (e) {
                document.getElementById(typingId)?.remove();
                messages.innerHTML += `<div class="chat-bubble bot">‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</div>`;
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
